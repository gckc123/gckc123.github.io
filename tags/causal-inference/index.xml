<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Causal Inference on StatsNotebook - Simple. Powerful. Reproducible.</title>
    <link>https://statsnotebook.io/tags/causal-inference/</link>
    <description>Recent content in Causal Inference on StatsNotebook - Simple. Powerful. Reproducible.</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 12 Apr 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://statsnotebook.io/tags/causal-inference/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Propensity Score Matching</title>
      <link>https://statsnotebook.io/blog/analysis/matching/</link>
      <pubDate>Tue, 12 Apr 2022 00:00:00 +0000</pubDate>
      
      <guid>https://statsnotebook.io/blog/analysis/matching/</guid>
      <description>&lt;p&gt;The tutorial is based on &lt;a href=&#34;https://r-project.org&#34; title=&#34;The R project for statistical computing&#34;&gt;R&lt;/a&gt; and &lt;a href=&#34;https://statsnotebook.io&#34; title=&#34;StatsNotebook&#34;&gt;StatsNotebook&lt;/a&gt;, a graphical interface for R.&lt;/p&gt;
&lt;p&gt;Randomised controlled trials (RCTs) are the gold standard for causal inference. In RCTs, randomisation removes all confoundings between the treatment (exposure) and control group. However, RCTs are not always feasible due to ethical or logistic issues (e.g., testing the causal impact of smoking on lung cancer). Propensity score matching can be used to emulate the balance between treatment and control group in an observational study.
At its simplest, &lt;strong&gt;propensity score matching&lt;/strong&gt; matches each individual in the treatment group to an individual in the control group based on their &lt;em&gt;propensity score&lt;/em&gt;. For each individual, the &lt;em&gt;propensity score&lt;/em&gt; can be intuitively considered as the probability of recentiving treatment, calcuated from a range of covariates (and potential confounders). Two individuals, one from treatment and one from control group, is considered to be a match if the difference between their propensity score is small. Unmatched participants are discarded.&lt;/p&gt;
&lt;p&gt;After matching, the treatment group and the control group should have very similar characteristics. A simple regression model can be used to estimate the treatment effect on the outcome. Cluster-robust standard errors are required for correct inference.&lt;/p&gt;

&lt;h4 id=&#34;example-research-questions&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#example-research-questions&#34;&gt;Example research questions&lt;/a&gt;&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;Is smoking associated with psychological distress?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In this setup, the &lt;em&gt;treatment&lt;/em&gt; variable is smoking; the &lt;em&gt;outcome&lt;/em&gt; variable is psychological distress. This research question will be addressed by &lt;strong&gt;propensity score matching&lt;/strong&gt;. We will first match each smoker in the dataset to a non-smoker based on a range of covariates, including sex (male/ female), indigenous status (indigenous or not), education level (high school completion), marital status (partnered or not), region of residence (major cities, inner regional or outer regional), language background (English speaking or not), age and risky alcohol use (Yes/ No).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Propensity score matching&lt;/strong&gt; analysis involves two steps.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Match each smoker to a non-smoker based on propensity score, which is calculated based on a range of covariates.&lt;/li&gt;
&lt;li&gt;Check if balance between smokers (treatment/exposure group) and non-smokers (control group) is achieved (i.e., both groups having similar characteristics). If balance is achieved, a simple regression analysis with cluster-robust standard error can be used to estimate the effect of smoking on psychological distress.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We will first show the R code for this analysis below, and we will provide a step-by-step guide on how to complete this analysis. We use the &lt;strong&gt;Psychological distress and smoking&lt;/strong&gt; dataset, which can be loaded using the following codes (internet connection is required)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(tidyverse)
currentDataset &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;https://raw.githubusercontent.com/gckc123/ExampleData/main/smoking_psyc_distress.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;
&lt;p&gt;There are ten variables in this dataset.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sex (0: Female; 1: Male)&lt;/li&gt;
&lt;li&gt;indigenous - Ingigenous status (0: Non-indigenous; 1: indigenous)&lt;/li&gt;
&lt;li&gt;high_school - Education level (0: not finished high school; 1: finished high school)&lt;/li&gt;
&lt;li&gt;partnered - Marital status (0: not partnered; 1: partnered)&lt;/li&gt;
&lt;li&gt;remoteness - region of residence (0: major cities; 1: inner regional; 2: outer regional)&lt;/li&gt;
&lt;li&gt;language - Language background (0: non-English speaking; 1: English speaking)&lt;/li&gt;
&lt;li&gt;Smoker - Smoking status (0: non-smoker; 1: smoker)&lt;/li&gt;
&lt;li&gt;risky_alcohol - Risky alcohol use (0: not risky; 1: risky)&lt;/li&gt;
&lt;li&gt;psyc_distress - Psychological distress. Measure ranges from 10 to 50.&lt;/li&gt;
&lt;li&gt;age - Age of the participants&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;r-codes-for-matching-step-1&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#r-codes-for-matching-step-1&#34;&gt;R codes for matching (Step 1)&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;The following is the compete codes for our &lt;strong&gt;propensity score matching&lt;/strong&gt; example.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#Since remoteness is a categorical variable with more than two categories. It is necessary to convert &lt;/span&gt;
&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#it into a factor variable.&lt;/span&gt;
&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#For other categorical variable with only 2 levels, this is optional if the variable is coded as 0 and 1.&lt;/span&gt;
currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;remoteness &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;factor&lt;/span&gt;(currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;remoteness, exclude &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;))

&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#The MatchIt, lmtest and sandwich libraries are used.&lt;/span&gt;
&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(MatchIt)
&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(lmtest)
&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(sandwich)

&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#Using the mathcit function from MatchIt to match each smoker with a non-smoker (1 to 1 matching) based on&lt;/span&gt;
&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#sex, indigeneity status, high school completion, marital status (partnered or not),&lt;/span&gt;
&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#region of residence (major cities, inner regional, outer regional), language background (English speaking Yes/No) &lt;/span&gt;
&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#and risky alcohol drinking (Yes/No)&lt;/span&gt;
match_obj &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;matchit&lt;/span&gt;(smoker &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; indigeneity &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; high_school &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; partnered &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; remoteness &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; language &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; risky_alcohol &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; age,
  data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; currentDataset, method &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;nearest&amp;#34;&lt;/span&gt;, distance &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;glm&amp;#34;&lt;/span&gt;,
  ratio &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;,
  replace &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;)
&lt;span style=&#34;color:#06287e&#34;&gt;summary&lt;/span&gt;(match_obj)

&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#plotting the balance between smokers and non-smokers&lt;/span&gt;
&lt;span style=&#34;color:#06287e&#34;&gt;plot&lt;/span&gt;(match_obj, type &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;jitter&amp;#34;&lt;/span&gt;, interactive &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;)
&lt;span style=&#34;color:#06287e&#34;&gt;plot&lt;/span&gt;(&lt;span style=&#34;color:#06287e&#34;&gt;summary&lt;/span&gt;(match_obj), abs &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;

&lt;h4 id=&#34;using-statsnotebook-for-matching-step-1&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#using-statsnotebook-for-matching-step-1&#34;&gt;Using StatsNotebook for matching (Step 1)&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;Prior to running the propensity score matching, it is always a good practice to &lt;a href=&#34;https://statsnotebook.io/blog/dataviz/&#34; title=&#34;DataViz&#34;&gt;visualise the data&lt;/a&gt; and conduct a &lt;a href=&#34;https://statsnotebook.io/blog/analysis/descriptive/&#34; title=&#34;descriptive statistics&#34;&gt;descriptive analysis&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To conduct propensity score matching,&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Click &lt;strong&gt;Analysis&lt;/strong&gt; at the top;&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Causal&lt;/strong&gt; and select &lt;strong&gt;Matching&lt;/strong&gt; from the menu&lt;/li&gt;
&lt;li&gt;In the left panel, select &lt;em&gt;smoker&lt;/em&gt; into &lt;em&gt;Exposure&lt;/em&gt;, and select &lt;em&gt;sex&lt;/em&gt;, &lt;em&gt;indigeneity&lt;/em&gt;, &lt;em&gt;high_school&lt;/em&gt;, &lt;em&gt;partnered&lt;/em&gt;, &lt;em&gt;remoteness&lt;/em&gt;, &lt;em&gt;lauguage&lt;/em&gt; &lt;em&gt;psyc_distress&lt;/em&gt; and &lt;em&gt;age&lt;/em&gt; into &lt;em&gt;Covariates&lt;/em&gt;.
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;remoteness&lt;/strong&gt; is a categorical variable with three levels (&lt;em&gt;major cities&lt;/em&gt;, &lt;em&gt;inner regional&lt;/em&gt; and &lt;em&gt;outer regional&lt;/em&gt;). If it is not yet coded as &lt;strong&gt;factor&lt;/strong&gt;, we will need to manually &lt;a href=&#34;https://statsnotebook.io/blog/data_management/variable_conversion/&#34; title=&#34;variable converstion&#34;&gt;convert it into a &lt;strong&gt;factor&lt;/strong&gt; variable&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;sex&lt;/strong&gt;, &lt;strong&gt;indigeneity&lt;/strong&gt;, &lt;strong&gt;high_school&lt;/strong&gt;, &lt;strong&gt;partnered&lt;/strong&gt; and &lt;strong&gt;language&lt;/strong&gt; are also categorical variable. But since they are binary (i.e., only have two levels coded as 0 and 1), it is not necessary to convert them into &lt;strong&gt;factor&lt;/strong&gt; variable.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Code and Run&lt;/strong&gt; at top. The above R code will be generated in a block on the right panel and the results will be presented below the R codes.&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/matching_instruction1.png&#34; alt=&#34;matching in statsnotebook&#34; title=&#34;matching in statsnotebook&#34;/&gt;&lt;/a&gt;

&lt;h4 id=&#34;r-codes-explained---matching&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#r-codes-explained---matching&#34;&gt;R codes explained - Matching&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;The following is a key section of the generated codes.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;match_obj &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;matchit&lt;/span&gt;(smoker &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; indigeneity &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; high_school &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; partnered &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; remoteness &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; language &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; risky_alcohol &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; age,
  data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; currentDataset, method &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;nearest&amp;#34;&lt;/span&gt;, distance &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;glm&amp;#34;&lt;/span&gt;,
  ratio &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;,
  replace &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;)
&lt;span style=&#34;color:#06287e&#34;&gt;summary&lt;/span&gt;(match_obj)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;
&lt;p&gt;This code tells R to run a propensity score matching using the &lt;strong&gt;matchit&lt;/strong&gt; function from the &lt;strong&gt;MatchIt&lt;/strong&gt; library. The left side of the &lt;strong&gt;&amp;ldquo;~&amp;rdquo;&lt;/strong&gt; symbol specifies the &lt;em&gt;exposure variable&lt;/em&gt;; the right side specifies the &lt;em&gt;covariates&lt;/em&gt;. The results from this propensity score matching is then printed out using the &lt;strong&gt;summary&lt;/strong&gt; function.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;em&gt;distance&lt;/em&gt; parameter specifies that generalised linear model is used to calculate the propensity score based on all covariates (&lt;em&gt;distance = &amp;ldquo;glm&amp;rdquo;&lt;/em&gt;); Other models such as generalised boosted model (gbm) or generalized additive model (gam) can be used.&lt;/li&gt;
&lt;li&gt;The &lt;em&gt;method&lt;/em&gt; parameter specifies that matching is based on nearest matching (&lt;em&gt;method = &amp;ldquo;nearest&amp;rdquo;&lt;/em&gt;); Other methods such as &amp;ldquo;optimal&amp;rdquo; and &amp;ldquo;exact&amp;rdquo; can be used.&lt;/li&gt;
&lt;li&gt;The &lt;em&gt;ratio&lt;/em&gt; parameter specifies that one to one matching is used (&lt;em&gt;ratio = 1&lt;/em&gt;). A higher ratio will increase the number of samples from the control group that will be included. Therefore, less observations will be discarded. However a higher matching ratio by definition will produce worse matches.&lt;/li&gt;
&lt;li&gt;The &lt;em&gt;replace&lt;/em&gt; parameter specifies that the matching is conducted without replacement.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;These settings generally produce satisfactory results and will be sufficient in many scenarios.&lt;/p&gt;
&lt;p&gt;This code produces the result summary below.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;######################################################&lt;/span&gt;

Call&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt;
&lt;span style=&#34;color:#06287e&#34;&gt;matchit&lt;/span&gt;(formula &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; smoker &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; indigeneity &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; high_school &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; 
    partnered &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; remoteness &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; language &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; risky_alcohol &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; age, 
    data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; currentDataset, method &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;nearest&amp;#34;&lt;/span&gt;, distance &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;glm&amp;#34;&lt;/span&gt;, 
    replace &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;, ratio &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;)

Summary of Balance for All Data&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt;
              Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean
distance             &lt;span style=&#34;color:#40a070&#34;&gt;0.1852&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.1130&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.6304&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;2.0778&lt;/span&gt;    &lt;span style=&#34;color:#40a070&#34;&gt;0.2033&lt;/span&gt;
sex                  &lt;span style=&#34;color:#40a070&#34;&gt;0.4938&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.4421&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.1035&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0518&lt;/span&gt;
indigeneity          &lt;span style=&#34;color:#40a070&#34;&gt;0.0524&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.0175&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.1565&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0349&lt;/span&gt;
high_school          &lt;span style=&#34;color:#40a070&#34;&gt;0.4220&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.6378&lt;/span&gt;         &lt;span style=&#34;color:#40a070&#34;&gt;-0.4370&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.2158&lt;/span&gt;
partnered            &lt;span style=&#34;color:#40a070&#34;&gt;0.4630&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.6913&lt;/span&gt;         &lt;span style=&#34;color:#40a070&#34;&gt;-0.4578&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.2283&lt;/span&gt;
remoteness0          &lt;span style=&#34;color:#40a070&#34;&gt;0.5852&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.6773&lt;/span&gt;         &lt;span style=&#34;color:#40a070&#34;&gt;-0.1870&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0921&lt;/span&gt;
remoteness1          &lt;span style=&#34;color:#40a070&#34;&gt;0.2177&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.1900&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.0670&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0277&lt;/span&gt;
remoteness2          &lt;span style=&#34;color:#40a070&#34;&gt;0.1971&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.1327&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.1621&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0645&lt;/span&gt;
language             &lt;span style=&#34;color:#40a070&#34;&gt;0.9579&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.9130&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.2234&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0449&lt;/span&gt;
risky_alcohol        &lt;span style=&#34;color:#40a070&#34;&gt;0.6427&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.5411&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.2120&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.1016&lt;/span&gt;
age                 &lt;span style=&#34;color:#40a070&#34;&gt;51.6057&lt;/span&gt;       &lt;span style=&#34;color:#40a070&#34;&gt;53.7824&lt;/span&gt;         &lt;span style=&#34;color:#40a070&#34;&gt;-0.1676&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;0.8214&lt;/span&gt;    &lt;span style=&#34;color:#40a070&#34;&gt;0.0441&lt;/span&gt;
              eCDF Max
distance        &lt;span style=&#34;color:#40a070&#34;&gt;0.3185&lt;/span&gt;
sex             &lt;span style=&#34;color:#40a070&#34;&gt;0.0518&lt;/span&gt;
indigeneity     &lt;span style=&#34;color:#40a070&#34;&gt;0.0349&lt;/span&gt;
high_school     &lt;span style=&#34;color:#40a070&#34;&gt;0.2158&lt;/span&gt;
partnered       &lt;span style=&#34;color:#40a070&#34;&gt;0.2283&lt;/span&gt;
remoteness0     &lt;span style=&#34;color:#40a070&#34;&gt;0.0921&lt;/span&gt;
remoteness1     &lt;span style=&#34;color:#40a070&#34;&gt;0.0277&lt;/span&gt;
remoteness2     &lt;span style=&#34;color:#40a070&#34;&gt;0.0645&lt;/span&gt;
language        &lt;span style=&#34;color:#40a070&#34;&gt;0.0449&lt;/span&gt;
risky_alcohol   &lt;span style=&#34;color:#40a070&#34;&gt;0.1016&lt;/span&gt;
age             &lt;span style=&#34;color:#40a070&#34;&gt;0.1020&lt;/span&gt;


Summary of Balance for Matched Data&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt;
              Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean
distance             &lt;span style=&#34;color:#40a070&#34;&gt;0.1852&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.1847&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.0042&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;1.0209&lt;/span&gt;    &lt;span style=&#34;color:#40a070&#34;&gt;0.0002&lt;/span&gt;
sex                  &lt;span style=&#34;color:#40a070&#34;&gt;0.4938&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.5010&lt;/span&gt;         &lt;span style=&#34;color:#40a070&#34;&gt;-0.0144&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0072&lt;/span&gt;
indigeneity          &lt;span style=&#34;color:#40a070&#34;&gt;0.0524&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.0370&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.0691&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0154&lt;/span&gt;
high_school          &lt;span style=&#34;color:#40a070&#34;&gt;0.4220&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.4107&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.0229&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0113&lt;/span&gt;
partnered            &lt;span style=&#34;color:#40a070&#34;&gt;0.4630&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.4764&lt;/span&gt;         &lt;span style=&#34;color:#40a070&#34;&gt;-0.0268&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0133&lt;/span&gt;
remoteness0          &lt;span style=&#34;color:#40a070&#34;&gt;0.5852&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.5986&lt;/span&gt;         &lt;span style=&#34;color:#40a070&#34;&gt;-0.0271&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0133&lt;/span&gt;
remoteness1          &lt;span style=&#34;color:#40a070&#34;&gt;0.2177&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.2146&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.0075&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0031&lt;/span&gt;
remoteness2          &lt;span style=&#34;color:#40a070&#34;&gt;0.1971&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.1869&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.0258&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0103&lt;/span&gt;
language             &lt;span style=&#34;color:#40a070&#34;&gt;0.9579&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.9620&lt;/span&gt;         &lt;span style=&#34;color:#40a070&#34;&gt;-0.0205&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0041&lt;/span&gt;
risky_alcohol        &lt;span style=&#34;color:#40a070&#34;&gt;0.6427&lt;/span&gt;        &lt;span style=&#34;color:#40a070&#34;&gt;0.6407&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.0043&lt;/span&gt;          .    &lt;span style=&#34;color:#40a070&#34;&gt;0.0021&lt;/span&gt;
age                 &lt;span style=&#34;color:#40a070&#34;&gt;51.6057&lt;/span&gt;       &lt;span style=&#34;color:#40a070&#34;&gt;51.2064&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.0307&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;0.9171&lt;/span&gt;    &lt;span style=&#34;color:#40a070&#34;&gt;0.0150&lt;/span&gt;
              eCDF Max Std. Pair Dist.
distance        &lt;span style=&#34;color:#40a070&#34;&gt;0.0113&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.0052&lt;/span&gt;
sex             &lt;span style=&#34;color:#40a070&#34;&gt;0.0072&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.2854&lt;/span&gt;
indigeneity     &lt;span style=&#34;color:#40a070&#34;&gt;0.0154&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.2627&lt;/span&gt;
high_school     &lt;span style=&#34;color:#40a070&#34;&gt;0.0113&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.1725&lt;/span&gt;
partnered       &lt;span style=&#34;color:#40a070&#34;&gt;0.0133&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.1874&lt;/span&gt;
remoteness0     &lt;span style=&#34;color:#40a070&#34;&gt;0.0133&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.3230&lt;/span&gt;
remoteness1     &lt;span style=&#34;color:#40a070&#34;&gt;0.0031&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.2463&lt;/span&gt;
remoteness2     &lt;span style=&#34;color:#40a070&#34;&gt;0.0103&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.3407&lt;/span&gt;
language        &lt;span style=&#34;color:#40a070&#34;&gt;0.0041&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.1329&lt;/span&gt;
risky_alcohol   &lt;span style=&#34;color:#40a070&#34;&gt;0.0021&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.2957&lt;/span&gt;
age             &lt;span style=&#34;color:#40a070&#34;&gt;0.0390&lt;/span&gt;          &lt;span style=&#34;color:#40a070&#34;&gt;0.3717&lt;/span&gt;

Percent Balance Improvement&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt;
              Std. Mean Diff. Var. Ratio eCDF Mean eCDF Max
distance                 &lt;span style=&#34;color:#40a070&#34;&gt;99.3&lt;/span&gt;       &lt;span style=&#34;color:#40a070&#34;&gt;97.2&lt;/span&gt;      &lt;span style=&#34;color:#40a070&#34;&gt;99.9&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;96.5&lt;/span&gt;
sex                      &lt;span style=&#34;color:#40a070&#34;&gt;86.1&lt;/span&gt;          .      &lt;span style=&#34;color:#40a070&#34;&gt;86.1&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;86.1&lt;/span&gt;
indigeneity              &lt;span style=&#34;color:#40a070&#34;&gt;55.8&lt;/span&gt;          .      &lt;span style=&#34;color:#40a070&#34;&gt;55.8&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;55.8&lt;/span&gt;
high_school              &lt;span style=&#34;color:#40a070&#34;&gt;94.8&lt;/span&gt;          .      &lt;span style=&#34;color:#40a070&#34;&gt;94.8&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;94.8&lt;/span&gt;
partnered                &lt;span style=&#34;color:#40a070&#34;&gt;94.2&lt;/span&gt;          .      &lt;span style=&#34;color:#40a070&#34;&gt;94.2&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;94.2&lt;/span&gt;
remoteness0              &lt;span style=&#34;color:#40a070&#34;&gt;85.5&lt;/span&gt;          .      &lt;span style=&#34;color:#40a070&#34;&gt;85.5&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;85.5&lt;/span&gt;
remoteness1              &lt;span style=&#34;color:#40a070&#34;&gt;88.9&lt;/span&gt;          .      &lt;span style=&#34;color:#40a070&#34;&gt;88.9&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;88.9&lt;/span&gt;
remoteness2              &lt;span style=&#34;color:#40a070&#34;&gt;84.1&lt;/span&gt;          .      &lt;span style=&#34;color:#40a070&#34;&gt;84.1&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;84.1&lt;/span&gt;
language                 &lt;span style=&#34;color:#40a070&#34;&gt;90.8&lt;/span&gt;          .      &lt;span style=&#34;color:#40a070&#34;&gt;90.8&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;90.8&lt;/span&gt;
risky_alcohol            &lt;span style=&#34;color:#40a070&#34;&gt;98.0&lt;/span&gt;          .      &lt;span style=&#34;color:#40a070&#34;&gt;98.0&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;98.0&lt;/span&gt;
age                      &lt;span style=&#34;color:#40a070&#34;&gt;81.7&lt;/span&gt;       &lt;span style=&#34;color:#40a070&#34;&gt;56.0&lt;/span&gt;      &lt;span style=&#34;color:#40a070&#34;&gt;66.0&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;61.8&lt;/span&gt;

Sample Sizes&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt;
          Control Treated
All          &lt;span style=&#34;color:#40a070&#34;&gt;7026&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;974&lt;/span&gt;
Matched       &lt;span style=&#34;color:#40a070&#34;&gt;974&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;974&lt;/span&gt;
Unmatched    &lt;span style=&#34;color:#40a070&#34;&gt;6052&lt;/span&gt;       &lt;span style=&#34;color:#40a070&#34;&gt;0&lt;/span&gt;
Discarded       &lt;span style=&#34;color:#40a070&#34;&gt;0&lt;/span&gt;       &lt;span style=&#34;color:#40a070&#34;&gt;0&lt;/span&gt;

&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;######################################################&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;

&lt;h5 id=&#34;matching-results-explained&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#matching-results-explained&#34;&gt;Matching results explained&lt;/a&gt;&lt;/h5&gt;
&lt;p&gt;In the top section of the results, the balance between smoker and non-smoker group in each of the covariates are shown. The column on &lt;em&gt;Std. Mean Diff.&lt;/em&gt; shows that there are substantial difference in nearly all covariates between smokers and non-smokers (a standardised mean difference great than 0.1 can be considered as substantial difference).&lt;/p&gt;
&lt;p&gt;In the middle section, the balance between smoker and non-smoker group after matching are shown. The standardised mean differences are now all close to zero for all covariates, indicating that a good balance is achieved.&lt;/p&gt;
&lt;p&gt;The last section shows that there are 7026 non-smokers and 974 smokers in the original sample. All smokers are matched to a corresponding non-smokers. The remaining 6052 non-smokers are not matched to any smokers and can be discarded in subsequent analysis. Applied researchers sometimes are concerned about discarding a large number of unmatched participants. However, this is usually not an issue if all treated participants are matched, and good balance is archived.&lt;/p&gt;
&lt;p&gt;The above codes also produce the following two figures. The first one visualises the distribution of propensity score in the matched treated group, matched control group and the unmatched control group. Propensity score matching will not be appropriate if there is not a satisfactory overlap in the propensity score distribution between the matched treated group and the matched untreated group. The second figure visualises the balance in propensity score and all covariates before and after matching. Similar to the results from the table, there are substantial difference in all covariates between smokers and non-smokers before matching, but the difference is close to zero after matching, indicating a very good balance.&lt;/p&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/matching_figure1.png&#34; alt=&#34;propensity score distribution&#34; title=&#34;propensity score distribution&#34;/&gt;&lt;/a&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/matching_figure2.png&#34; alt=&#34;balance before and after matching&#34; title=&#34;balance before and after matching&#34;/&gt;&lt;/a&gt;

&lt;h4 id=&#34;r-codes-for-outcome-analysis-step-2&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#r-codes-for-outcome-analysis-step-2&#34;&gt;R codes for outcome analysis (Step 2)&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;Once we achieve a good balance between the treatment and control group after matching, we can proceed to the next step to analyse the difference in outcome between the two groups. We can analyse the data as if the data are from an RCT using a regression analysis. However, for correct inference, cluster-robust standard error is needed.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#Extract the matched data and save the data into the variable matched_data&lt;/span&gt;
matched_data &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;match.data&lt;/span&gt;(match_obj)

&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#Run regression model with psychological distress as the outcome, and smoker as the only predictor&lt;/span&gt;
&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#We need to specify the weights - Matched participants have a weight of 1, unmatched participants &lt;/span&gt;
res &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;lm&lt;/span&gt;(psyc_distress &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; smoker, data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; matched_data, weights &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; weights)

&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#Test the coefficient using cluster robust standard error&lt;/span&gt;
&lt;span style=&#34;color:#06287e&#34;&gt;coeftest&lt;/span&gt;(res, vcov. &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; vcovCL, cluster &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt;subclass)
&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#Calculate the confidence intervals based on cluster robust standard error&lt;/span&gt;
&lt;span style=&#34;color:#06287e&#34;&gt;coefci&lt;/span&gt;(res, vcov. &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; vcovCL, cluster &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt;subclass, level &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.95&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;

&lt;h4 id=&#34;using-statsnotebook-for-outcome-analysis-step-2&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#using-statsnotebook-for-outcome-analysis-step-2&#34;&gt;Using StatsNotebook for outcome analysis (Step 2)&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;The following steps will generate the R codes for both matching and outcome analysis. It should be noted that we should only conduct outcome analysis after we achieve a satisfactory balance between treatment and control group.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;In addition to the procedure in &lt;a href=&#34;https://statsnotebook.io/blog/analysis/matching/#using-statsnotebook-for-matching-step-1&#34; title=&#34;propensity score matching step 1&#34;&gt;step 1&lt;/a&gt;, we now select &lt;em&gt;psyc_distress&lt;/em&gt; into &lt;em&gt;Outcome&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;Expand the &lt;em&gt;Analysis setting&lt;/em&gt; panel in the bottom, click &lt;em&gt;Analyse the outcome&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Code and Run&lt;/strong&gt; at top. This will generate both the codes for propensity score matching and outcome analysis.&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/matching_instruction2.png&#34; alt=&#34;outcome analysis after matching in statsnotebook&#34; title=&#34;outcome analysis after matching in statsnotebook&#34;/&gt;&lt;/a&gt;

&lt;h4 id=&#34;r-output-and-interpretation&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#r-output-and-interpretation&#34;&gt;R output and interpretation&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;The followings are the output from the outcome analysis. The results indicate that psychological distress among smokers is 1.66 point higher than non-smokers (95% CI [1.08, 2.24]).&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;######################################################&lt;/span&gt;

t test of coefficients&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt;

            Estimate Std. Error t value  &lt;span style=&#34;color:#06287e&#34;&gt;Pr&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;|&lt;/span&gt;t&lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;)    
(Intercept) &lt;span style=&#34;color:#40a070&#34;&gt;15.65298&lt;/span&gt;    &lt;span style=&#34;color:#40a070&#34;&gt;0.20093&lt;/span&gt;  &lt;span style=&#34;color:#40a070&#34;&gt;77.904&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;2.2e-16&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;***&lt;/span&gt;
smoker       &lt;span style=&#34;color:#40a070&#34;&gt;1.66016&lt;/span&gt;    &lt;span style=&#34;color:#40a070&#34;&gt;0.29657&lt;/span&gt;   &lt;span style=&#34;color:#40a070&#34;&gt;5.598&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;2.477e-08&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;***&lt;/span&gt;
&lt;span style=&#34;color:#666&#34;&gt;---&lt;/span&gt;
Signif. codes&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt;  &lt;span style=&#34;color:#40a070&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#39;***&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.001&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#39;**&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.01&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.05&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.1&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;


&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;######################################################&lt;/span&gt;
                &lt;span style=&#34;color:#40a070&#34;&gt;2.5&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;%    97.5 %&lt;/span&gt;
(Intercept) &lt;span style=&#34;color:#40a070&#34;&gt;15.258922&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;16.047032&lt;/span&gt;
smoker       &lt;span style=&#34;color:#40a070&#34;&gt;1.078545&lt;/span&gt;  &lt;span style=&#34;color:#40a070&#34;&gt;2.241783&lt;/span&gt;

&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;######################################################&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;

&lt;h4 id=&#34;write-up&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#write-up&#34;&gt;Write-up&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;Propensity score matching was used to estimate the effect of smoking on psychological distress. The propensity score were estimated using logistic regression based on sex, indigenous status, education level (completed high school or not), marital status (partnered or not), region of residence (major cities, inner regional or outer regional), language background (English speaking Yes/No), risky alcohol use (Yes/ No) and age. One-to-one nearest neighbour matching was used. All smokers (N = 974) were matched to a non-smoker. Good balance was achieved between the smoker and non-smoker group, with all standardized mean differences below 0.1 after matching.&lt;/p&gt;
&lt;p&gt;To estimate the effect of smoking on psychological distress, a linear regression with psychological distress as the outcome and smoking status (smoker/ non-smoker) as the exposure was fitted. Cluster-robust variance was used to estimate the standard error. It is estimated that smoking increases psychological distress by 1.66 point (95% CI [1.08, 2.24], p &amp;lt; .001&amp;gt;).&lt;/p&gt;
&lt;p&gt;All analyses were conducted in StatsNotebook (Chan and StatsNotebook team, 2020) using R 4.1 and the MatchIt package (Stuart, King, Imai and Ho, 2011).&lt;/p&gt;

&lt;h4 id=&#34;citation&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#citation&#34;&gt;Citation&lt;/a&gt;&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;Chan, G. and StatsNotebook Team (2020). StatsNotebook. [Computer Software]. Retrieved from https://www.statsnotebook.io
Stuart, King, Imai and Ho. (2011). MatchIt: nonparametric preprocessing for parametric causal inference. Journal of statistical software.
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title></title>
      <link>https://statsnotebook.io/blog/analysis/itsa/</link>
      <pubDate>Sun, 01 Aug 2021 00:00:00 +0000</pubDate>
      
      <guid>https://statsnotebook.io/blog/analysis/itsa/</guid>
      <description>&lt;p&gt;The tutorial is based on &lt;a href=&#34;https://r-project.org&#34; title=&#34;The R project for statistical computing&#34;&gt;R&lt;/a&gt; and &lt;a href=&#34;https://statsnotebook.io&#34; title=&#34;StatsNotebook&#34;&gt;StatsNotebook&lt;/a&gt;, a graphical interface for R.&lt;/p&gt;
&lt;p&gt;Coming soon&amp;hellip;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Causal inference: Inverse probability treatment weighting</title>
      <link>https://statsnotebook.io/blog/analysis/marginal_structural_model_iptw/</link>
      <pubDate>Wed, 05 May 2021 00:00:00 +0000</pubDate>
      
      <guid>https://statsnotebook.io/blog/analysis/marginal_structural_model_iptw/</guid>
      <description>&lt;p&gt;The tutorial is based on &lt;a href=&#34;https://r-project.org&#34; title=&#34;The R project for statistical computing&#34;&gt;R&lt;/a&gt; and &lt;a href=&#34;https://statsnotebook.io&#34; title=&#34;StatsNotebook&#34;&gt;StatsNotebook&lt;/a&gt;, a graphical interface for R.&lt;/p&gt;
&lt;p&gt;In multiwave longitudinal study, the exposure is often time-varying. A time varying confounder is a time varying variable that is affected by previous exposures, and also affect future exposure and outcome, thus confounding the relationship between the exposure and the outcome. Time varying confounding is common in longitudinal research. When evaluating the relationship between a time-varying exposure and outcome, standard methods such as regression and generalised linear models produce biased estimates in the presence of time-varying confounders. Inverse probability treatment weight and marginal structural model can be used to adjust for time-varying confounding.&lt;/p&gt;
&lt;p&gt;In this tutorial, we will use a simulated dataset to answer the following research question&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Does cannabis use during adolescence cause illicit drug use in adulthood?&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The example data can be downloaded from &lt;a href=&#34;https://statsnotebook.io/blog/data_management/example_data/iptw_example.csv&#34;/&gt;
    here
&lt;/a&gt;. In this example, we will use a complete dataset (i.e. no missing data). If your dataet has missing data, we would recommend that you read this tutorial and then our tutorial on &lt;a href=&#34;https://statsnotebook.io/blog/analysis/marginal_structural_model_iptw_with_missing/&#34; title=&#34;iptw with missing data&#34;&gt;inverse probability treatment weighting with missing data&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Supposed that the data was collected over 5 time points, baseline (wave 0) and follow-up wave 1 to 4. The baseline and wave 1 to 3 were collected at Grade 7, 8, 9 and 10. Wave 4 was collected at age 25.&lt;/p&gt;
&lt;p&gt;In this dataset, there are several key variables.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Academic grade (&lt;strong&gt;failed&lt;/strong&gt;; 0: no failed subjects; failed at least one subject)&lt;/li&gt;
&lt;li&gt;Peers&amp;rsquo; cannabis use (&lt;strong&gt;peer_can&lt;/strong&gt;: 0: None; 1: 1-2 friends used cannabis; 2: 3 or more friends used cannabis)&lt;/li&gt;
&lt;li&gt;Antisocial behaviour (&lt;strong&gt;antisocial&lt;/strong&gt;: 0: No antisocial behaviour; 1: engaged in antisocial behaviour)&lt;/li&gt;
&lt;li&gt;Cannabis use (&lt;strong&gt;can&lt;/strong&gt;; 0: No use; 1: used)&lt;/li&gt;
&lt;li&gt;Sex (&lt;strong&gt;sex&lt;/strong&gt;; 0: male; 1: female)&lt;/li&gt;
&lt;li&gt;Family history of drug use (&lt;strong&gt;family_drug_use&lt;/strong&gt;; 0: no; 1: at least one immediate family member used drug. This is only measured at baseline.)&lt;/li&gt;
&lt;li&gt;Illicit drug use at age 25 (&lt;strong&gt;illicit&lt;/strong&gt;: 0: No use; 1: used)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The suffix of each variable indicates the time point the data is collected. For example, peer_can_0 represent the number of peers who used cannabis at baseline (wave 0).&lt;/p&gt;
&lt;p&gt;This dataset can also be loaded using the following codes&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(tidyverse)
currentDataset &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;https://statsnotebook.io/blog/data_management/example_data/iptw_example.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Given this design, we can now make our research question more specific&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Does cannabis use in follow-up wave 1 to wave 3 (in Grade 8, 9 and 10) cause use of illicit drug at age 25?&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In this research question, cannabis use is the exposure variable and is time-varying. When estimating the relationship between adolescent cannabis use (wave 1 to wave 3) on future illicit drug use, many of the variables above are likely to be time-varying confounders. The figure below is a conceptual diagram demonstrating the complex relationships between the exposure, confounders and the outcome.&lt;/p&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/iptw_figure.png&#34; alt=&#34;longitudinal data&#34; title=&#34;longitudinal data&#34;/&gt;&lt;/a&gt;
&lt;p&gt;B represents a set of baseline covariates/ potential confounders (e.g. family history of drug use). It can be regarded as a special subset of C&lt;sub&gt;1&lt;/sub&gt;. &lt;br/&gt;
A&lt;sub&gt;1&lt;/sub&gt;, A&lt;sub&gt;2&lt;/sub&gt; and A&lt;sub&gt;3&lt;/sub&gt; represent the exposures (cannabis use) at Wave 1, 2 and 3. &lt;br/&gt;
C&lt;sub&gt;1&lt;/sub&gt;, C&lt;sub&gt;2&lt;/sub&gt; and C&lt;sub&gt;3&lt;/sub&gt; represent the set of covariates/confounders for the exposure variable at Wave 1, 2 and 3 (e.g. peers&amp;rsquo; cannabis use). To retain the temporal order of exposure and confounders, the set C&lt;sub&gt;1&lt;/sub&gt;, C&lt;sub&gt;2&lt;/sub&gt; and C&lt;sub&gt;3&lt;/sub&gt; should be selected from the preceding wave of the exposure. Therefore, the variables in the set C&lt;sub&gt;1&lt;/sub&gt;, C&lt;sub&gt;2&lt;/sub&gt; and C&lt;sub&gt;3&lt;/sub&gt; should be from baseline, follow-up wave 1 and follow-up wave 2 respectively. &lt;br/&gt;&lt;/p&gt;
&lt;p&gt;Y is the outcome (illicit drug use at age 25).&lt;br/&gt;&lt;/p&gt;
&lt;p&gt;Take Peers&amp;rsquo; cannabis use as an example. Peers&amp;rsquo; cannabis use is likely to be a time-varying confounder because&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;An individual&amp;rsquo;s cannabis use in one wave is likely to increase affiliation with cannabis using peers in future waves.&lt;/li&gt;
&lt;li&gt;Peers&amp;rsquo; cannabis use in one wave is likely to increase the risk of an individual&amp;rsquo;s cannabis use and illicit drug use in future waves&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/iptw_figure2.png&#34; alt=&#34;iptw longitudinal data&#34; title=&#34;iptw longitudinal data&#34;/&gt;&lt;/a&gt;
&lt;p&gt;Therefore, peers&amp;rsquo; cannabis use is a time-varying mediator (because it was affected by previous cannabis use and would affect future illicit drug use) and a time-varying confounder (because it would affect both future cannabis use and future illicit drug use). Other variables, such as antisocial behaviour, are also likely to be time-varying confounders.&lt;/p&gt;
&lt;p&gt;Regression-based methods generally give biased estimates of the effects of time-varying exposures on an outcome when time-varying confounders are present. In the example above, adjusting for peers&amp;rsquo; cannabis use at wave 2 will block some of the effect of cannabis use at wave 1. Not adjusting for peers&amp;rsquo; cannabis use at wave 2 will bias the estimate of cannabis use at wave 3 on future illicit drug use. This is because peers&amp;rsquo; cannabis use at wave 2 may confound the relationship between cannabis use at wave 3 and illicit drug use at the final wave. Therefore, performing a regression analysis would produce biased estimate, regardless of whether adjustment is made for peers&amp;rsquo; cannabis use.&lt;/p&gt;
&lt;p&gt;Inverse probability treatment weighting (IPTW) can be used to estimate the causal effect of cannabis use on future illicit drug use. Conceptually, IPTW attempts to fully adjust for measured confounders by balancing the confounders across levels of treatment with treatment weight. It creates a pseudo-population in which all measured confounders are balanced between different treatment groups (in the example above, it will be between different cannabis use trajectories). The data can be regarded as coming from a randomized controlled trial and thus causal inference can be made by simple comparisons between groups (i.e. t-test).&lt;/p&gt;
&lt;p&gt;For valid causal inference, the following key assumptions need to be met.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Exchangeability&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This is also known as the no unmeasured confounding assumption. It is assumed that all confounders are used to calculate IPTW. While it is nearly impossible to include all confounders in the IPTW calculation, we will need to select a wide range of potential confounders based on a theoretical framework to improve the validity of this assumption. In our example, we determine that family, peer and school variables are important confounders that could affect both adolescent cannabis use and future illicit drug use. We therefore include family history of drug use, peers&amp;rsquo; cannabis use, academic grade and antisocial behaviour to calculate IPTW.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Positivity&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The probability of receiving treatment (i.e. using cannabis in our example) and not receiving treatment are both non-zero. This assumption is violated if treatment is deterministic. (e.g. if all children of parents who have used illicit drugs will later use cannabis, this assumption is violated.)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Correctness of the model for calculating the IPTW&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Logistic regressions are usually used to estimate IPTW. Interaction terms can be included into the model to improve the validity of this assumption. Machine learning models can also be used to calculate IPTW to capture potential non-linear effect.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Now we will demonstrate using the &lt;a href=&#34;https://statsnotebook.io/blog/data_management/example_data/iptw_example.csv&#34;/&gt;
    simulated example data
&lt;/a&gt; to test &lt;em&gt;the cumulative exposure effect of cannabis use from follow-up wave 1 to wave 3 on future illicit drug use at wave 4&lt;/em&gt;. We will provide a step-by-step guide on how to use &lt;strong&gt;StatsNotebook&lt;/strong&gt; to generate the R codes to calculate IPTW. Then we will conduct a weighted analysis on the weighted sample. The &lt;code&gt;ipw&lt;/code&gt; package will be used to calculate the IPTW, and the &lt;code&gt;survey&lt;/code&gt; package will be used to conduct the weighted analysis.&lt;/p&gt;
&lt;p&gt;We will first calculate the weight at each time point by calculating the probability of receiving/ not receiving treatment, based on the treatment history from previous waves, the history of confounders and baseline confounders/ covariates. In our example, we will need to calculate the weight at follow-up wave 1 to 3 separately, and then calulate a final IPTW by multiplying the three weights from follow-up wave 1 to 3.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;To calculate the weight at follow-up wave 1, we use the variables from C&lt;sub&gt;1&lt;/sub&gt;, including academic grade, peers&amp;rsquo; cannabis, antisocial behaviour, cannabis use, sex and family history of drug use at baseline.&lt;/li&gt;
&lt;li&gt;To calculate the weight at follow-up wave 2, we use all the variables from the previous step, plus academic grade, peers&amp;rsquo; cannabis and antisocial behaviour at follow-up wave 1 (history of all confounders), and cannabis use at follow-up wave 1 (exposure history).&lt;/li&gt;
&lt;li&gt;To calculate the weight at follow-up wave 3, we use all the variables from the previous step, plus academic grade, peers&amp;rsquo; cannabis and antisocial behaviour at follow-up wave 2, and cannabis use at follow-up wave 2.&lt;/li&gt;
&lt;/ol&gt;

&lt;h5 id=&#34;using-statsnotebook---calculating-iptw&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#using-statsnotebook---calculating-iptw&#34;&gt;Using StatsNotebook - Calculating IPTW&lt;/a&gt;&lt;/h5&gt;
&lt;p&gt;Prior to calculating the IPTW, we will need to conduct a &lt;a href=&#34;https://statsnotebook.io/blog/analysis/descriptive/&#34; title=&#34;Descriptive statistics&#34;&gt;descriptive analysis&lt;/a&gt; and it is always good practice to &lt;a href=&#34;https://statsnotebook.io/blog/dataviz/&#34; title=&#34;dataviz&#34;&gt;visualise the data&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To calculate the IPTW,&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Click &lt;strong&gt;Analysis&lt;/strong&gt; at the top&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Causal&lt;/strong&gt; in the top menu&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Inverse Probability Treatment Weighting (IPTW)&lt;/strong&gt; in the pop-up menu&lt;/li&gt;
&lt;li&gt;In the left panel, select &lt;em&gt;can_1&lt;/em&gt; into &lt;em&gt;Exposure&lt;/em&gt;, and select &lt;em&gt;failed_0&lt;/em&gt;, &lt;em&gt;peer_can_0&lt;/em&gt; and &lt;em&gt;antisocial_0&lt;/em&gt; into &lt;em&gt;Time-varying covariates&lt;/em&gt;. As mentioned before, since baseline confounders/covariates can be regarded as a special subset of Time-varying covariates at Wave 1, we further select &lt;em&gt;family_drug_use&lt;/em&gt;, &lt;em&gt;sex&lt;/em&gt;  and &lt;em&gt;can_0&lt;/em&gt; (baseline cannabis use) into &lt;em&gt;Time-varying covariates&lt;/em&gt;.
&lt;ul&gt;
&lt;li&gt;To ensure the temporal order of the variables, we use covariates from baseline to calculate IPTW for exopsure at follow-up wave 1.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/iptw_instruction1.png&#34; alt=&#34;iptw instruction&#34; title=&#34;iptw instruction&#34;/&gt;&lt;/a&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;Click the top &lt;strong&gt;+&lt;/strong&gt; button on top of &lt;em&gt;Exposure&lt;/em&gt; to add an extra time point (extra wave).&lt;/li&gt;
&lt;li&gt;Select &lt;em&gt;can_2&lt;/em&gt; into &lt;em&gt;Exposure&lt;/em&gt;, and select &lt;em&gt;failed_1&lt;/em&gt;, &lt;em&gt;peer_can_1&lt;/em&gt; and &lt;em&gt;antisocial_1&lt;/em&gt; into &lt;em&gt;Time-varying covariates&lt;/em&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/iptw_instruction2.png&#34; alt=&#34;iptw instruction 2&#34; title=&#34;iptw instruction 2&#34;/&gt;&lt;/a&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;Repeat step 5 and 6 for &lt;em&gt;can_3&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Expand the panel &lt;em&gt;Analysis Setting&lt;/em&gt; at the below the variable selection panel.&lt;/li&gt;
&lt;li&gt;For &lt;em&gt;Distribution family&lt;/em&gt;, select &lt;em&gt;Binomial&lt;/em&gt;.
&lt;ul&gt;
&lt;li&gt;Since the exposure is a dichotomised variable (cannabis use or no cannabis use), logistic regression will be used to estimate the IPTW.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/iptw_instruction3.png&#34; alt=&#34;iptw instruction 3&#34; title=&#34;iptw instruction 3&#34;/&gt;&lt;/a&gt;
&lt;ol start=&#34;10&#34;&gt;
&lt;li&gt;Click &lt;strong&gt;Code and Run&lt;/strong&gt;. The R codes below will be generated and executed.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Four new variables, &lt;em&gt;.ipw0&lt;/em&gt;, &lt;em&gt;.ipw1&lt;/em&gt;, &lt;em&gt;.ipw2&lt;/em&gt; and &lt;em&gt;.final_weight&lt;/em&gt; will be created. The first three are the IPTW at follow-up wave 1 to 3 and the last one is the product of the first three weights and will be used for subsequent outcome modelling.&lt;/p&gt;

&lt;h5 id=&#34;r-codes---calculating-iptw&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#r-codes---calculating-iptw&#34;&gt;R codes - Calculating IPTW&lt;/a&gt;&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(ipw)

&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Calculate IPTW&amp;#34;&lt;/span&gt;

weight &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;ipwpoint&lt;/span&gt;(exposure &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; can_1, family &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;binomial&amp;#34;&lt;/span&gt;, link &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;logit&amp;#34;&lt;/span&gt;,
  numerator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;,
  denominator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; failed_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;family_drug_use&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;sex&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_0,
  trunc &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.01&lt;/span&gt;, data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;as.data.frame&lt;/span&gt;(currentDataset))
currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw0 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; weight&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;weights.trunc

weight &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;ipwpoint&lt;/span&gt;(exposure &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; can_2, family &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;binomial&amp;#34;&lt;/span&gt;, link &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;logit&amp;#34;&lt;/span&gt;,
  numerator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; can_1,
  denominator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;family_drug_use&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;sex&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_1,
  trunc &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.01&lt;/span&gt;, data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;as.data.frame&lt;/span&gt;(currentDataset))
currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw1 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; weight&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;weights.trunc

weight &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;ipwpoint&lt;/span&gt;(exposure &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; can_3, family &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;binomial&amp;#34;&lt;/span&gt;, link &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;logit&amp;#34;&lt;/span&gt;,
  numerator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_2,
  denominator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_2&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;family_drug_use&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;sex&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_2&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_2&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_2,
  trunc &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.01&lt;/span&gt;, data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;as.data.frame&lt;/span&gt;(currentDataset))
currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw2 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; weight&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;weights.trunc

currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.final_weight &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw0&lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw1&lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw2


&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Chan, G. and StatsNotebook Team (2020). StatsNotebook. (Version 0.1.0) [Computer Software]. Retrieved from https://www.statsnotebook.io&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;R Core Team (2020). The R Project for Statistical Computing. [Computer software]. Retrieved from https://r-project.org&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;van der Wal, W. M. and R. B. Geskus (2011). ipw: an R package for inverse probability weighting. J Stat Softw 43(13): 1-23.&amp;#34;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;

&lt;h5 id=&#34;r-codes-explained---calculating-iptw&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#r-codes-explained---calculating-iptw&#34;&gt;R codes explained - Calculating IPTW&lt;/a&gt;&lt;/h5&gt;
&lt;p&gt;At each time point, we calculate the weight using the &lt;code&gt;ipwpoint&lt;/code&gt; function. For example, the code below calculates the weight for follow-up wave 1 by estimating the probability of cannabis use at follow-up wave 1 (exposure; can_1) based on academic grade (failed_0), peers&amp;rsquo; cannabis use (peer_can_0), antisocial behaviour (antisocial_0), family history of drug use (family_drug_use), sex (sex) and cannabis use at baseline (can_0).&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;weight &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;ipwpoint&lt;/span&gt;(exposure &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; can_1, family &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;binomial&amp;#34;&lt;/span&gt;, link &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;logit&amp;#34;&lt;/span&gt;,
  numerator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;,
  denominator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; failed_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;family_drug_use&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;sex&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_0,
  trunc &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.01&lt;/span&gt;, data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;as.data.frame&lt;/span&gt;(currentDataset))
currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw0 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; weight&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;weights.trunc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;
Similiarly, we will calculate the weight for follow-up wave 2 and wave 3 using the code below.
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;weight &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;ipwpoint&lt;/span&gt;(exposure &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; can_2, family &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;binomial&amp;#34;&lt;/span&gt;, link &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;logit&amp;#34;&lt;/span&gt;,
  numerator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; can_1,
  denominator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;family_drug_use&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;sex&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_1,
  trunc &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.01&lt;/span&gt;, data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;as.data.frame&lt;/span&gt;(currentDataset))
currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw1 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; weight&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;weights.trunc

weight &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;ipwpoint&lt;/span&gt;(exposure &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; can_3, family &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;binomial&amp;#34;&lt;/span&gt;, link &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;logit&amp;#34;&lt;/span&gt;,
  numerator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_2,
  denominator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_2&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;family_drug_use&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;sex&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_2&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_2&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_2,
  trunc &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.01&lt;/span&gt;, data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;as.data.frame&lt;/span&gt;(currentDataset))
currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw2 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; weight&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;weights.trunc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;
And lastly, we will multiply all these weights to form the final IPTW.
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.final_weight &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw0&lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw1&lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;

&lt;h5 id=&#34;using-statsnotebook---weighted-analysis&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#using-statsnotebook---weighted-analysis&#34;&gt;Using StatsNotebook - Weighted analysis&lt;/a&gt;&lt;/h5&gt;
&lt;p&gt;After calculating the IPTW, confounding due to included variables in the IPTW calculation will be removed in a weighted analysis. To estimate the causal effect of cumulative exposure, measured as the number of wave an individual reported using cannabis between follow-up wave 1 and wave 3, we first create a new variable (&lt;em&gt;cumulative&lt;/em&gt;) by summing up &lt;em&gt;can_1&lt;/em&gt;, &lt;em&gt;can_2&lt;/em&gt; and &lt;em&gt;can_3&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;To create this new variable in &lt;strong&gt;StatsNotebook&lt;/strong&gt;,&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Click &lt;strong&gt;Data&lt;/strong&gt; at the top&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Compute&lt;/strong&gt; at the top menu&lt;/li&gt;
&lt;li&gt;Type &lt;em&gt;cumulative&lt;/em&gt; in the &lt;em&gt;Target Variable&lt;/em&gt; field.&lt;/li&gt;
&lt;li&gt;You can select variable in the &lt;em&gt;Variable&lt;/em&gt; list and use &lt;strong&gt;+&lt;/strong&gt; to add the corresponding variables up.&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/compute_cumulative.png&#34; alt=&#34;compute cumulative&#34; title=&#34;compute cumulative&#34;/&gt;&lt;/a&gt;
&lt;p&gt;The &lt;strong&gt;R code&lt;/strong&gt; for this operation is simple.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;cumulative &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;can_2&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;can_3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt; 
&lt;p&gt;Once we have created the &lt;em&gt;cumulative&lt;/em&gt; variable, we can use the &lt;code&gt;survey&lt;/code&gt; package to conduct a weighted analysis to estimate the causal effect of cumulative use for cannabis use during adolescence on illicit drug use in young adulthood (age 25). &lt;strong&gt;Logistic regression&lt;/strong&gt; is used because the outcome, illicit drug use, is a dichotomized variable (0: No; 1: Yes).&lt;/p&gt;
&lt;p&gt;To conduct a weighted analysis,&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Click &lt;strong&gt;Analysis&lt;/strong&gt; at the top&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Regression&lt;/strong&gt; at the top menu&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Logistic regression&lt;/strong&gt; (linear regression can be used if the outcome is a numeric variable.)&lt;/li&gt;
&lt;li&gt;In the left panel, select &lt;em&gt;illicit&lt;/em&gt; into &lt;em&gt;Outcome&lt;/em&gt;, &lt;em&gt;cumulative&lt;/em&gt; into &lt;em&gt;Covariate&lt;/em&gt; and &lt;em&gt;.final_weight&lt;/em&gt; into &lt;em&gt;Weight&lt;/em&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/msm_instruction.png&#34; alt=&#34;msm instruction&#34; title=&#34;msm instruction&#34;/&gt;&lt;/a&gt;

&lt;h5 id=&#34;r-codes---weighted-analysis&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#r-codes---weighted-analysis&#34;&gt;R codes - Weighted analysis&lt;/a&gt;&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(survey)

clus &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;svydesign&lt;/span&gt;(id &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;, weights &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; .final_weight, data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; currentDataset)
res &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;svyglm&lt;/span&gt;(illicit &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; cumulative, design &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; clus,family &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; binomial)
&lt;span style=&#34;color:#06287e&#34;&gt;summary&lt;/span&gt;(res)
&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Model coefficients and confidence intervals&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#06287e&#34;&gt;cbind&lt;/span&gt;(&lt;span style=&#34;color:#06287e&#34;&gt;coef&lt;/span&gt;(res), &lt;span style=&#34;color:#06287e&#34;&gt;confint&lt;/span&gt;(res, level &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.95&lt;/span&gt;))

&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Odds ratios and confidence intervals&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#06287e&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#06287e&#34;&gt;cbind&lt;/span&gt;(OR &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;coef&lt;/span&gt;(res), &lt;span style=&#34;color:#06287e&#34;&gt;confint&lt;/span&gt;(res, level &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.95&lt;/span&gt;)))


car&lt;span style=&#34;color:#666&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#06287e&#34;&gt;infIndexPlot&lt;/span&gt;(res)


&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Chan, G. and StatsNotebook Team (2020). StatsNotebook. (Version 0.1.0) [Computer Software]. Retrieved from https://www.statsnotebook.io&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;R Core Team (2020). The R Project for Statistical Computing. [Computer software]. Retrieved from https://r-project.org&amp;#34;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;
&lt;p&gt;The code for a weighted logistic regression is straightforward. The &lt;code&gt;survey&lt;/code&gt; package is loaded using the &lt;code&gt;library&lt;/code&gt; function. The following line then specifies that the variable &lt;em&gt;.final_weight&lt;/em&gt; is used as the weighting variable.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;clus &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;svydesign&lt;/span&gt;(id &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;, weights &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; .final_weight, data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; currentDataset)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;
&lt;p&gt;Then we use the following lines to run the weighted logistic regression and request the model results from R.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;res &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;svyglm&lt;/span&gt;(illicit &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; cumulative, design &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; clus,family &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; binomial)
&lt;span style=&#34;color:#06287e&#34;&gt;summary&lt;/span&gt;(res)
&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Model coefficients and confidence intervals&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#06287e&#34;&gt;cbind&lt;/span&gt;(&lt;span style=&#34;color:#06287e&#34;&gt;coef&lt;/span&gt;(res), &lt;span style=&#34;color:#06287e&#34;&gt;confint&lt;/span&gt;(res, level &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.95&lt;/span&gt;))

&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Odds ratios and confidence intervals&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#06287e&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#06287e&#34;&gt;cbind&lt;/span&gt;(OR &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;coef&lt;/span&gt;(res), &lt;span style=&#34;color:#06287e&#34;&gt;confint&lt;/span&gt;(res, level &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.95&lt;/span&gt;)))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;
&lt;p&gt;The codes above produce the following results.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;######################################################&lt;/span&gt;

Call&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt;
&lt;span style=&#34;color:#06287e&#34;&gt;svyglm&lt;/span&gt;(formula &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; cumulative, design &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; clus, family &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; binomial)

Survey design&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt;
&lt;span style=&#34;color:#06287e&#34;&gt;svydesign&lt;/span&gt;(id &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt;&lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;, weights &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt;.final_weight, data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; currentDataset)

Coefficients&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt;
            Estimate Std. Error t value &lt;span style=&#34;color:#06287e&#34;&gt;Pr&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;|&lt;/span&gt;t&lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;)    
(Intercept)  &lt;span style=&#34;color:#40a070&#34;&gt;-2.6639&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;0.2270&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;-11.734&lt;/span&gt;  &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;2e-16&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;***&lt;/span&gt;
cumulative    &lt;span style=&#34;color:#40a070&#34;&gt;0.7865&lt;/span&gt;     &lt;span style=&#34;color:#40a070&#34;&gt;0.2288&lt;/span&gt;   &lt;span style=&#34;color:#40a070&#34;&gt;3.438&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.000649&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;***&lt;/span&gt;
&lt;span style=&#34;color:#666&#34;&gt;---&lt;/span&gt;
Signif. codes&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt;  &lt;span style=&#34;color:#40a070&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#39;***&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.001&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#39;**&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.01&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.05&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.1&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;

(Dispersion parameter for binomial family taken to be &lt;span style=&#34;color:#40a070&#34;&gt;1.000884&lt;/span&gt;)

Number of Fisher Scoring iterations&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;5&lt;/span&gt;


&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;######################################################&lt;/span&gt;
[1] &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Model coefficients and confidence intervals&amp;#34;&lt;/span&gt;

&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;######################################################&lt;/span&gt;
                            &lt;span style=&#34;color:#40a070&#34;&gt;2.5&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;%    97.5 %&lt;/span&gt;
(Intercept) &lt;span style=&#34;color:#40a070&#34;&gt;-2.6639296&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;-3.1089045&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;-2.218955&lt;/span&gt;
cumulative   &lt;span style=&#34;color:#40a070&#34;&gt;0.7865248&lt;/span&gt;  &lt;span style=&#34;color:#40a070&#34;&gt;0.3380718&lt;/span&gt;  &lt;span style=&#34;color:#40a070&#34;&gt;1.234978&lt;/span&gt;

&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;######################################################&lt;/span&gt;
[1] &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Odds ratios and confidence intervals&amp;#34;&lt;/span&gt;

&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;######################################################&lt;/span&gt;
                   OR      &lt;span style=&#34;color:#40a070&#34;&gt;2.5&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;%    97.5 %&lt;/span&gt;
(Intercept) &lt;span style=&#34;color:#40a070&#34;&gt;0.0696739&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.04464984&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.1087227&lt;/span&gt;
cumulative  &lt;span style=&#34;color:#40a070&#34;&gt;2.1957526&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1.40224124&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;3.4383024&lt;/span&gt;

&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;######################################################&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;
&lt;p&gt;It should be noted that you may also see the warning message below. This is expected because we have fractional weights.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;######################################################&lt;/span&gt;
Warning message&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt; non&lt;span style=&#34;color:#666&#34;&gt;-&lt;/span&gt;integer &lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;#successes in a binomial glm!&lt;/span&gt;

&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;######################################################&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;

&lt;h5 id=&#34;interpretation&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#interpretation&#34;&gt;Interpretation&lt;/a&gt;&lt;/h5&gt;
&lt;p&gt;Results from the weighted logistic regression indicates that cannabis use was strongly associated with future illicit drug use, b = 0.79, 95% CI = [0.34, 1.23], p &amp;lt; .001. The corresponding odds ratio was 2.20, 95% CI = [1.40, 3.44]. For every additional wave an individual used cannabis, the odds of using illicit drug at age 25 was increased by 2.20 times. It is likely that we can interpret this association as causal, as we have adjusted for key confounding (and time-varying) variables from several important domains such as family, school and peer group. However, it is very likely that the true effect will be slightly smaller due to residual confounding (confounding effect not capture by the variables we used in the analysis.)&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>IPTW with missing data</title>
      <link>https://statsnotebook.io/blog/analysis/marginal_structural_model_iptw_with_missing/</link>
      <pubDate>Sat, 05 Dec 2020 00:00:00 +0000</pubDate>
      
      <guid>https://statsnotebook.io/blog/analysis/marginal_structural_model_iptw_with_missing/</guid>
      <description>&lt;p&gt;The tutorial is based on &lt;a href=&#34;https://r-project.org&#34; title=&#34;The R project for statistical computing&#34;&gt;R&lt;/a&gt; and &lt;a href=&#34;https://statsnotebook.io&#34; title=&#34;StatsNotebook&#34;&gt;StatsNotebook&lt;/a&gt;, a graphical interface for R.&lt;/p&gt;
&lt;p&gt;This is a follow-up tutorial built on our tutorial on &lt;a href=&#34;https://statsnotebook.io/blog/analysis/marginal_structural_model_iptw/&#34; title=&#34;iptw&#34;&gt;inverse probability treatment weight&lt;/a&gt;. In this tutorial, we use the same example, but with some missing data in the dataset. It is recommended that you read our tutorial on &lt;a href=&#34;https://statsnotebook.io/blog/analysis/marginal_structural_model_iptw/&#34; title=&#34;iptw&#34;&gt;inverse probability treatment weight&lt;/a&gt; first.&lt;/p&gt;
&lt;p&gt;The example data can be downloaded from &lt;a href=&#34;https://statsnotebook.io/blog/data_management/example_data/iptw_example_with_missing.csv&#34;/&gt;
    here
&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This data can also be loaded using the following codes.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(tidyverse)
currentDataset &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;https://statsnotebook.io/blog/data_management/example_data/iptw_example_with_missing.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If your dataset has missing data, &lt;a href=&#34;https://statsnotebook.io/blog/analysis/multiple_imputation/&#34; title=&#34;multiple imputation&#34;&gt;multiple imputation&lt;/a&gt; can be firstly used to impute the missing value. &lt;strong&gt;StatsNotebook&lt;/strong&gt; provides a shortcut for incorporating multiple imputation with IPTW. The shortcut method will only use variables for the IPTW calculation to impute the missing value. If more auxiliary variables or interaction between variables are needed for the imputation, we can &lt;a href=&#34;https://statsnotebook.io/blog/analysis/multiple_imputation/&#34; title=&#34;multiple imputation&#34;&gt;conduct the imputation manually&lt;/a&gt; first. This tutorial will demonstrate the shortcut method.&lt;/p&gt;
&lt;p&gt;In the presence of missing data,&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Multiple imputation will be used to impute missing values first. As a rule of thumb, the number of imputations needed is roughly the same as the percentage of missing data.&lt;/li&gt;
&lt;li&gt;IPTW is computed for each imputed dataset.&lt;/li&gt;
&lt;li&gt;The outcome model will be run on each imputed dataset.&lt;/li&gt;
&lt;li&gt;Results from different imputed datasets are combined using Rubin&amp;rsquo;s formula.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;StatsNotebook&lt;/strong&gt; uses the &lt;code&gt;mice&lt;/code&gt; package for multiple imputation, and then uses the &lt;code&gt;mitools&lt;/code&gt; package to combine results from the outcome models to form final estimates using Rubin&amp;rsquo;s formula.&lt;/p&gt;
&lt;p&gt;The section below will provide a step-by-step guide on using IPTW with multiple imputations to answer the research question&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Does cannabis use in follow-up wave 1 to wave 3 (in Grade 8, 9 and 10) cause use of illicit drug at age 25?&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In this example dataset, the key variables are&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Academic grade (&lt;strong&gt;failed&lt;/strong&gt;; 0: no failed subjects; failed at least one subject)&lt;/li&gt;
&lt;li&gt;Peers&amp;rsquo; cannabis use (&lt;strong&gt;peer_can&lt;/strong&gt;: 0: None; 1: 1-2 friends used cannabis; 2: 3 or more friends used cannabis)&lt;/li&gt;
&lt;li&gt;Antisocial behaviour (&lt;strong&gt;antisocial&lt;/strong&gt;: 0: No antisocial behaviour; 1: engaged in antisocial behaviour)&lt;/li&gt;
&lt;li&gt;Cannabis use (&lt;strong&gt;can&lt;/strong&gt;; 0: No use; 1: used)&lt;/li&gt;
&lt;li&gt;Sex (&lt;strong&gt;sex&lt;/strong&gt;; 0: male; 1: female)&lt;/li&gt;
&lt;li&gt;Family history of drug use (&lt;strong&gt;family_drug_use&lt;/strong&gt;; 0: no; 1: at least one immediate family member used drug. This is only measured at baseline.)&lt;/li&gt;
&lt;li&gt;Illicit drug use at age 25 (&lt;strong&gt;illicit&lt;/strong&gt;: 0: No use; 1: used)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The suffix of each variable indicates the time point the data is collected. For example, peer_can_0 represents the number of peers who used cannabis at baseline (wave 0).&lt;/p&gt;
&lt;p&gt;For the detailed setup of this analysis, please see our tutorial on &lt;a href=&#34;https://statsnotebook.io/blog/analysis/marginal_structural_model_iptw/&#34; title=&#34;iptw&#34;&gt;inverse probability treatment weight&lt;/a&gt;, in which we used a complete dataset instead of one with missing data.&lt;/p&gt;

&lt;h5 id=&#34;using-statsnotebook---calculating-iptw&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#using-statsnotebook---calculating-iptw&#34;&gt;Using StatsNotebook - Calculating IPTW&lt;/a&gt;&lt;/h5&gt;
&lt;p&gt;Prior to calculating the IPTW, we will need to conduct a &lt;a href=&#34;https://statsnotebook.io/blog/analysis/descriptive/&#34; title=&#34;Descriptive statistics&#34;&gt;descriptive analysis&lt;/a&gt; and it is always good practice to &lt;a href=&#34;https://statsnotebook.io/blog/dataviz/&#34; title=&#34;dataviz&#34;&gt;visualise the data&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To perform multiple imputation and then to calculate the IPTW for each imputed dataset,&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Click &lt;strong&gt;Analysis&lt;/strong&gt; at the top&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Causal&lt;/strong&gt; in the top menu&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Inverse Probability Treatment Weighting (IPTW)&lt;/strong&gt; in the pop-up menu&lt;/li&gt;
&lt;li&gt;In the left panel, select &lt;em&gt;can_1&lt;/em&gt; into &lt;em&gt;Exposure&lt;/em&gt;, and select &lt;em&gt;failed_0&lt;/em&gt;, &lt;em&gt;peer_can_0&lt;/em&gt; and &lt;em&gt;antisocial_0&lt;/em&gt; into &lt;em&gt;Time-varying covariates&lt;/em&gt;. As mentioned before, since baseline confounders/covariates can be regarded as a special subset of Time-varying covariates at Wave 1, we further select &lt;em&gt;family_drug_use&lt;/em&gt;, &lt;em&gt;sex&lt;/em&gt;  and &lt;em&gt;can_0&lt;/em&gt; (baseline cannabis use) into &lt;em&gt;Time-varying covariates&lt;/em&gt;.
&lt;ul&gt;
&lt;li&gt;To ensure the temporal order of the variables, we use covariates from baseline to calculate IPTW for the expsoure variable at follow-up wave 1.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/iptw_instruction1.png&#34; alt=&#34;iptw instruction&#34; title=&#34;iptw instruction&#34;/&gt;&lt;/a&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;Click the top &lt;strong&gt;+&lt;/strong&gt; button on top of &lt;em&gt;Exposure&lt;/em&gt; to add an extra time point (extra wave).&lt;/li&gt;
&lt;li&gt;Select &lt;em&gt;can_2&lt;/em&gt; into &lt;em&gt;Exposure&lt;/em&gt;, and select &lt;em&gt;failed_1&lt;/em&gt;, &lt;em&gt;peer_can_1&lt;/em&gt; and &lt;em&gt;antisocial_1&lt;/em&gt; into &lt;em&gt;Time-varying covariates&lt;/em&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/iptw_instruction2.png&#34; alt=&#34;iptw instruction&#34; title=&#34;iptw instruction&#34;/&gt;&lt;/a&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;
&lt;p&gt;Repeat step 5 and 6 for &lt;em&gt;can_3&lt;/em&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Select &lt;em&gt;illicit&lt;/em&gt; into &lt;em&gt;Outcome&lt;/em&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This step is not necessary when there is no missing data. The variable in &lt;em&gt;Outcome&lt;/em&gt; is only used for the multiple imputation but not for calculating IPTW.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Expand the panel &lt;em&gt;Analysis Setting&lt;/em&gt; at the below the variable selection panel.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;For &lt;em&gt;Distribution family&lt;/em&gt;, select &lt;em&gt;Binomial&lt;/em&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Since the exposure is a dichotomised variable (cannabis use or no cannabis use), logistic regression will be used to estimate the IPTW.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Click &lt;em&gt;Impute missing data&lt;/em&gt;. In this example, we specify 20 imputations.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;As a rule of thumb, the number of imputations should be roughly the same as the percentage of missing data.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/iptw_instruction3_missing.png&#34; alt=&#34;iptw instruction&#34; title=&#34;iptw instruction&#34;/&gt;&lt;/a&gt;
&lt;ol start=&#34;12&#34;&gt;
&lt;li&gt;Click &lt;strong&gt;Code and Run&lt;/strong&gt;. The codes below will be generated and executed.&lt;/li&gt;
&lt;/ol&gt;

&lt;h5 id=&#34;r-codes---calculating-iptw&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#r-codes---calculating-iptw&#34;&gt;R codes - Calculating IPTW&lt;/a&gt;&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(ipw)

currentDataset &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; currentDataset&lt;span style=&#34;color:#06287e&#34;&gt;[which&lt;/span&gt;(currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.imp &lt;span style=&#34;color:#666&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0&lt;/span&gt;),]
currentDataset &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; currentDataset[&lt;span style=&#34;color:#666&#34;&gt;!&lt;/span&gt;(&lt;span style=&#34;color:#06287e&#34;&gt;names&lt;/span&gt;(currentDataset) &lt;span style=&#34;color:#666&#34;&gt;%in%&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;.id&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;.imp&amp;#34;&lt;/span&gt;))]

&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Impute missing data&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(mice)
&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(mitools)


formulas &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;make.formulas&lt;/span&gt;(currentDataset)

formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;illicit &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;illicit &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;can_1 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;can_1 &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;failed_0 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;failed_0 &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;can_0 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;can_0 &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;family_drug_use &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;family_drug_use &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;sex &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;sex &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;can_2 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;can_2 &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;failed_1 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;failed_1 &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;can_3 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;can_3 &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;failed_2 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;failed_2 &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;peer_can_2 &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_2
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;antisocial_2 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;antisocial_2 &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; illicit &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_0 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; family_drug_use &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sex &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; antisocial_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; can_3 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; failed_2 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; peer_can_2

meth &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;make.method&lt;/span&gt;(currentDataset)
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;failed_3&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;family_alc_supp_0&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;family_alc_supp_1&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;family_alc_supp_2&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;family_alc_supp_3&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;peer_can_3&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;peer_alc_0&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;peer_alc_1&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;peer_alc_2&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;peer_alc_3&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;antisocial_3&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;alc_0&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;alc_1&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;alc_2&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;alc_3&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;distress&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;alc_dep&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;.ipw0&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;.ipw1&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;.ipw2&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
meth[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;.final_weight&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;

imputedDataset &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;parlmice&lt;/span&gt;(currentDataset,
  method &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; meth,
  formulas &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; formulas,
  m &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;20&lt;/span&gt;,
  n.core &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;15&lt;/span&gt;, 
  n.imp.core &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt;)

&lt;span style=&#34;color:#06287e&#34;&gt;plot&lt;/span&gt;(imputedDataset)
currentDataset &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;complete&lt;/span&gt;(imputedDataset, action &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;long&amp;#34;&lt;/span&gt;, include &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)

&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Calculate IPTW&amp;#34;&lt;/span&gt;

split_imp &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.imp
mi_dataList &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;split&lt;/span&gt;(currentDataset, split_imp)

&lt;span style=&#34;color:#06287e&#34;&gt;for&lt;/span&gt;(i in &lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#06287e&#34;&gt;length&lt;/span&gt;(mi_dataList)) {
  weight &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;ipwpoint&lt;/span&gt;(exposure &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; can_1, family &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;binomial&amp;#34;&lt;/span&gt;, link &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;logit&amp;#34;&lt;/span&gt;,
    numerator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;,
    denominator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; failed_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;family_drug_use&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;sex,
    trunc &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.01&lt;/span&gt;, data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;as.data.frame&lt;/span&gt;(mi_dataList[[i]]))

  mi_dataList[[i]]&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw0 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; weight&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;weights.trunc

  weight &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;ipwpoint&lt;/span&gt;(exposure &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; can_2, family &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;binomial&amp;#34;&lt;/span&gt;, link &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;logit&amp;#34;&lt;/span&gt;,
    numerator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; can_1,
    denominator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;family_drug_use&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;sex&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_1,
    trunc &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.01&lt;/span&gt;, data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;as.data.frame&lt;/span&gt;(mi_dataList[[i]]))

  mi_dataList[[i]]&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw1 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; weight&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;weights.trunc

  weight &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;ipwpoint&lt;/span&gt;(exposure &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; can_3, family &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;binomial&amp;#34;&lt;/span&gt;, link &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;logit&amp;#34;&lt;/span&gt;,
    numerator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_2,
    denominator &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_2&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;can_0&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;family_drug_use&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;sex&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;failed_2&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;peer_can_2&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;antisocial_2,
    trunc &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.01&lt;/span&gt;, data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;as.data.frame&lt;/span&gt;(mi_dataList[[i]]))

  mi_dataList[[i]]&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw2 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; weight&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;weights.trunc

  mi_dataList[[i]]&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.final_weight &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; mi_dataList[[i]]&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw0&lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;mi_dataList[[i]]&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw1&lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;mi_dataList[[i]]&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw2

}

mi_dataList[[1]]&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw0 &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;
mi_dataList[[1]]&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw1 &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;
mi_dataList[[1]]&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.ipw2 &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;
mi_dataList[[1]]&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.final_weight &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;

currentDataset &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;unsplit&lt;/span&gt;(mi_dataList, split_imp)


&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Chan, G. and StatsNotebook Team (2020). StatsNotebook. (Version 0.1.0) [Computer Software]. Retrieved from https://www.statsnotebook.io&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;R Core Team (2020). The R Project for Statistical Computing. [Computer software]. Retrieved from https://r-project.org&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;van der Wal, W. M. and R. B. Geskus (2011). ipw: an R package for inverse probability weighting. J Stat Softw 43(13): 1-23.&amp;#34;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;
&lt;p&gt;Given the complexity of the codes, we will only give a conceptual explanation. For a detailed explanation on the specification of the multiple imputation model, see our tutorial on &lt;a href=&#34;https://statsnotebook.io/blog/analysis/multiple_imputation/&#34; title=&#34;Multiple imputation for missing data&#34;&gt;multiple imputation&lt;/a&gt;. In brief, the top section of the codes from above specify the variables used to impute each of the variables with missing data, perform the multiple imputation and generate the diagnostic plots for the imputation.&lt;/p&gt;
&lt;p&gt;In the second section, we compute the IPTW for each of the imputed dataset using an iterative &lt;code&gt;for&lt;/code&gt; loop.&lt;/p&gt;
&lt;p&gt;Six new variables will be created. &lt;em&gt;.imp&lt;/em&gt; is the identifier for each of the imputed datasets. The original data will have a value of 0. The &lt;em&gt;.id&lt;/em&gt; is the identifier for each observation in each imputed dataset. &lt;em&gt;.ipw0&lt;/em&gt;, &lt;em&gt;.ipw1&lt;/em&gt; and &lt;em&gt;.ipw2&lt;/em&gt;&lt;/p&gt;

&lt;h5 id=&#34;using-statsnotebook---weighted-analysis&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#using-statsnotebook---weighted-analysis&#34;&gt;Using StatsNotebook - Weighted analysis&lt;/a&gt;&lt;/h5&gt;
&lt;p&gt;After calculating the IPTW, confounding due to included variables in the IPTW calculation will be removed in a weighted analysis. To estimate the causal effect of the cumulative exposure (measured as the number of waves an individual reported using cannabis between follow-up wave 1 and wave 3), we first create a new variable (&lt;em&gt;cumulative&lt;/em&gt;) by summing up &lt;em&gt;can_1&lt;/em&gt;, &lt;em&gt;can_2&lt;/em&gt; and &lt;em&gt;can_3&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;To create this new variable in &lt;strong&gt;StatsNotebook&lt;/strong&gt;,&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Click &lt;strong&gt;Data&lt;/strong&gt; at the top&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Compute&lt;/strong&gt; at the top menu&lt;/li&gt;
&lt;li&gt;Type &lt;em&gt;cumulative&lt;/em&gt; in the &lt;em&gt;Target Variable&lt;/em&gt; field.&lt;/li&gt;
&lt;li&gt;You can select variable in the &lt;em&gt;Variable&lt;/em&gt; list and use &lt;em&gt;+&lt;/em&gt; to add the corresponding variables up.&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/compute_cumulative.png&#34; alt=&#34;compute cumulative&#34; title=&#34;compute cumulative&#34;/&gt;&lt;/a&gt;
&lt;p&gt;The &lt;strong&gt;R code&lt;/strong&gt; for this operation is simple.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;cumulative &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;can_1&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;can_2&lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt;currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;can_3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;
&lt;p&gt;Once we have created the &lt;em&gt;cumulative&lt;/em&gt; variable, we can use the &lt;code&gt;survey&lt;/code&gt; package to conduct a weighted analysis to estimate the causal effect of cumulative cannabis use during adolescence on illicit drug use in young adulthood (age 25) to estimate the model parameters from each imputed dataset separately. The &lt;code&gt;mitools&lt;/code&gt; package is used to pool the results to form a set of single estimates using Rubin&amp;rsquo;s formula. &lt;strong&gt;Logistic regression&lt;/strong&gt; is used because the outcome, illicit drug use, is a dichotomized variable (0: No; 1: Yes).&lt;/p&gt;
&lt;p&gt;To conduct a weighted analysis,&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Click &lt;strong&gt;Analysis&lt;/strong&gt; at the top&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Regression&lt;/strong&gt; at the top menu&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Logistic regression&lt;/strong&gt; (linear regression can be used if the outcome is a numeric variable.)&lt;/li&gt;
&lt;li&gt;In the left panel, select &lt;em&gt;illicit&lt;/em&gt; into &lt;em&gt;Outcome&lt;/em&gt;, &lt;em&gt;cumulative&lt;/em&gt; into &lt;em&gt;Covariate&lt;/em&gt; and &lt;em&gt;.final_weight&lt;/em&gt; into &lt;em&gt;Weight&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Expand the &lt;strong&gt;Analysis setting&lt;/strong&gt; panel, and check the box &lt;em&gt;This is an Imputed Dataset&lt;/em&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/msm_instruction_missing.png&#34; alt=&#34;compute cumulative&#34; title=&#34;compute cumulative&#34;/&gt;&lt;/a&gt;
&lt;br/&gt; 

&lt;h5 id=&#34;r-codes---weighted-analysis&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#r-codes---weighted-analysis&#34;&gt;R codes - Weighted analysis&lt;/a&gt;&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(mice)
&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(mitools)

&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(survey)

&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Weighted regression&amp;#34;&lt;/span&gt;

mi_dataList &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; currentDataset[currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.imp &lt;span style=&#34;color:#666&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0&lt;/span&gt;,]
mi_dataList &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;split&lt;/span&gt;(mi_dataList, mi_dataList&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;.imp)
mi_dataList &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;imputationList&lt;/span&gt;(mi_dataList)
clus &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;svydesign&lt;/span&gt;(id &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;, weights &lt;span style=&#34;color:#666&#34;&gt;=~&lt;/span&gt; .final_weight, data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; mi_dataList)
res &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;with&lt;/span&gt;(clus, &lt;span style=&#34;color:#06287e&#34;&gt;svyglm&lt;/span&gt;(illicit &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; cumulative, family &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; binomial))
&lt;span style=&#34;color:#06287e&#34;&gt;summary&lt;/span&gt;(&lt;span style=&#34;color:#06287e&#34;&gt;MIcombine&lt;/span&gt;(res), alpha &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.05&lt;/span&gt;,
  logeffect &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)

res1 &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; res[[1]]
car&lt;span style=&#34;color:#666&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#06287e&#34;&gt;infIndexPlot&lt;/span&gt;(res1)


&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Chan, G. and StatsNotebook Team (2020). StatsNotebook. (Version 0.1.0) [Computer Software]. Retrieved from https://www.statsnotebook.io&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;R Core Team (2020). The R Project for Statistical Computing. [Computer software]. Retrieved from https://r-project.org&amp;#34;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;
&lt;p&gt;The code above will produce multiple warning message. This is expected and not of any concern because we have fractional weights.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;######################################################
Warning message: non-integer #successes in a binomial glm!

######################################################
&lt;/code&gt;&lt;/pre&gt;&lt;br/&gt;
&lt;p&gt;The key results from the code above are as follow.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Multiple imputation results:
      with(clus, svyglm(illicit ~ cumulative, family = binomial))
      MIcombine.default(res)
               results         se     (lower    upper) missInfo
(Intercept) 0.06951018 0.01636046 0.04381953 0.1102628      7 %
cumulative  2.15334681 0.48705061 1.38223761 3.3546349      2 %
&lt;/code&gt;&lt;/pre&gt;&lt;br/&gt;

&lt;h5 id=&#34;interpretation&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#interpretation&#34;&gt;Interpretation&lt;/a&gt;&lt;/h5&gt;
&lt;p&gt;Results from the weighted logistic regression indicates that cannabis use was strongly associated with future illicit drug use, b = 2.15, 95% CI = [1.38, 3.36] (Your results will be slightly different because multiple imputation is not deterministic - every time the missing data is imputed, the value may be different). For every additional wave an individual used cannabis, the odds of using illicit drugs at age 25 increases by 2.15 times. It is likely that we can interpret this association as causal, as we have adjusted for key confounding (and time-varying) variables from several important domains such as family, school and peer group. However, it is very likely that the true effect will be smaller due to residual confounding (confounding effect not captured by the variables we used in the analysis.)&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>IPTW/MSM</title>
      <link>https://statsnotebook.io/consultation/iptw_msm/</link>
      <pubDate>Fri, 04 Dec 2020 00:00:00 +0000</pubDate>
      
      <guid>https://statsnotebook.io/consultation/iptw_msm/</guid>
      <description>&lt;p&gt;&lt;strong&gt;Follow &lt;a href=&#34;https://www.facebook.com/StatsNotebook/&#34;&gt;our Facebook page&lt;/a&gt; or &lt;a href=&#34;https://twitter.com/GaryCKChan&#34;&gt;our developer&amp;rsquo;s Twitter&lt;/a&gt; for more tutorials and future updates&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&#34;about-this-workshop&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#about-this-workshop&#34;&gt;About this workshop&lt;/a&gt;&lt;/h3&gt;

&lt;h4 id=&#34;adjusting-for-time-varying-confounders-using-iptw-for-causal-inference&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#adjusting-for-time-varying-confounders-using-iptw-for-causal-inference&#34;&gt;Adjusting for time-varying confounders using IPTW for causal inference&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;Randomized controlled trial is the gold standard for causal inference yet it is not always feasible. Multi-wave longitudinal data is increasingly used for causal inference. Standard methods such as regression yield biased results in the presence of time-varying confounders. In this workshop, I will demonstrate using Inverse probability treatment weight (IPTW) and marginal structural model (MSM) to adjust for time-varying confounders.&lt;/p&gt;
&lt;p&gt;Examples in this workshop will be based on research in psychology, public health and epidemiology, and the analyses will be conducted in R and StatsNotebook.&lt;/p&gt;
&lt;p&gt;Link for R:
&lt;a href=&#34;https://www.r-project.org/&#34;&gt;https://www.r-project.org/&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&#34;about-the-presenter&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#about-the-presenter&#34;&gt;About the presenter:&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;Dr. Gary Chan is a statistician and epidemiologist at the National Centre for Youth Substance Use Research, University of Queensland. He is the chief developer of StatsNotebook, an open source R based statistics app. His research focuses on statistical software development, causal inferences, and the epidemiology of substance use among young people. He has served as a consultant at the United Nations Office on Drugs and Crime to evaluate the data collection methodology on global substance use data, and as a biostatistical consultant for the West Moreton Health Service.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;../materials/2020_12_08_iptw_msm.pptx&#34;&gt;Download Slides&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;../materials/2020_12_08_iptw_msm.zip&#34;&gt;Download Slides with example datasets and analysis scripts&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Follow &lt;a href=&#34;https://www.facebook.com/StatsNotebook/&#34;&gt;our Facebook page&lt;/a&gt; or &lt;a href=&#34;https://twitter.com/GaryCKChan&#34;&gt;our developer&amp;rsquo;s Twitter&lt;/a&gt; for more tutorials and future updates&lt;/strong&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Causal Mediation Analysis</title>
      <link>https://statsnotebook.io/blog/analysis/mediation/</link>
      <pubDate>Wed, 23 Sep 2020 00:00:00 +0000</pubDate>
      
      <guid>https://statsnotebook.io/blog/analysis/mediation/</guid>
      <description>&lt;p&gt;The tutorial is based on &lt;a href=&#34;https://r-project.org&#34; title=&#34;The R project for statistical computing&#34;&gt;R&lt;/a&gt; and &lt;a href=&#34;https://statsnotebook.io&#34; title=&#34;StatsNotebook&#34;&gt;StatsNotebook&lt;/a&gt;, a graphical interface for R.&lt;/p&gt;
&lt;p&gt;Mediation analysis is a technique that examines the intermediate process by which the independent variable affects the dependent variable. For example, family intervention during adolescence (independent variable) can reduce engagement with deviant peer group (mediator) and their experimentation with drugs, which in turn reduces risk of substance use disorder in young adulthood (dependent variable).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;StatsNotebook&lt;/strong&gt; uses the cutting-edge counterfactual framework and Monte Carlo technique to conduct causal mediation analysis. It can handle&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;up to 3 mediators;&lt;/li&gt;
&lt;li&gt;numeric, dichotomized and count mediators and dependent variables;&lt;/li&gt;
&lt;li&gt;missing data using multiple imputation.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Since Monte Carlo method is very computationally intensive, it might take a long time to compute the mediation effect. Especially if there are missing data and multiple imputation is used.&lt;/strong&gt;&lt;/p&gt;

&lt;h4 id=&#34;example-research-questions&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#example-research-questions&#34;&gt;Example research questions&lt;/a&gt;&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;Does reduced engagement with deviant peer groups and reduced experimentation with drugs mediate the effect of the family intervention during adolescence on future substance use disorder?
&lt;ul&gt;
&lt;li&gt;In the example, we examine the causal chain &amp;ldquo;Participation in family intervention -&amp;gt; reduced engagement with deviant peer groups and experimentation with drugs -&amp;gt; substance use disorder in young adulthood&amp;rdquo;.&lt;/li&gt;
&lt;li&gt;In other words, we expect that participation in family intervention during adolescence reduces engagement with deviant peer groups and experimentation with drugs, which in turns reduces the likelihood for substance use disorder in young adulthood.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In this example, the &lt;em&gt;dependent variable&lt;/em&gt; is &lt;em&gt;substance use disorder&lt;/em&gt; and the &lt;em&gt;independent variable&lt;/em&gt; is &lt;em&gt;family intervention&lt;/em&gt;. There are two mediators: &lt;em&gt;engaged with deviant peer group&lt;/em&gt; and &lt;em&gt;experimentation with drugs&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;We will first show the R codes for this analysis below, and then we will provide a step-by-step guide on how to complete this analysis. We use the built-in &lt;strong&gt;substance&lt;/strong&gt; dataset in this example. This dataset can be loaded into &lt;strong&gt;StatsNotebook&lt;/strong&gt; using the instructions provided &lt;a href=&#34;https://statsnotebook.io/blog/data_management/load_example_data/&#34; title=&#34;load example&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In this dataset,&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;dev_peer&lt;/strong&gt; represents engagement with deviant peer groups and it was coded as &amp;ldquo;0: No&amp;rdquo; and &amp;ldquo;1: Yes&amp;rdquo;;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;sub_exp&lt;/strong&gt; represents experimentation with drugs and it was coded as &amp;ldquo;0: No&amp;rdquo; and &amp;ldquo;1: Yes&amp;rdquo;;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;fam_int&lt;/strong&gt; represents participation in family intervention during adolescence and it was coded as &amp;ldquo;0: No&amp;rdquo; and &amp;ldquo;1: Yes&amp;rdquo;;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;sub_disorder&lt;/strong&gt; represents diagnosis of substance use disorder in young adulthood and it was coded as &amp;ldquo;0: No: and &amp;ldquo;1: Yes&amp;rdquo;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;conflict&lt;/strong&gt; represents level of family conflict. It will be used as a covariate in this analysis.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;This dataset can also be loaded using the following codes&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(tidyverse)
currentDataset &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;read_csv&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;https://statsnotebook.io/blog/data_management/example_data/substance.csv&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5 id=&#34;r-codes&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#r-codes&#34;&gt;R codes&lt;/a&gt;&lt;/h5&gt;
&lt;p&gt;The first section of the code is for &lt;a href=&#34;https://statsnotebook.io/blog/analysis/multiple_imputation/&#34; title=&#34;Multiple imputation for missing data&#34;&gt;imputating missing data&lt;/a&gt;. In the second section, we use the &lt;code&gt;mediate&lt;/code&gt; function from the &lt;code&gt;intmed&lt;/code&gt; package to conduct a mediation analysis.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;fam_int_1 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;
currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;fam_int_1[currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;fam_int &lt;span style=&#34;color:#666&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;
currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;fam_int_1[currentDataset&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;fam_int &lt;span style=&#34;color:#666&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;] &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0&lt;/span&gt;

&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Multiple imputation&amp;#34;&lt;/span&gt;

&lt;span style=&#34;color:#06287e&#34;&gt;library&lt;/span&gt;(mice)

formulas &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;make.formulas&lt;/span&gt;(currentDataset)

formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;gender &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;gender &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; conflict &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sub_disorder &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; fam_int_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; dev_peer &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sub_exp
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;conflict &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;conflict &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; gender &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sub_disorder &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; fam_int_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; dev_peer &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sub_exp
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;sub_disorder &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;sub_disorder &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; gender &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; conflict &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; fam_int_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; dev_peer &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sub_exp
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;fam_int_1 &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;fam_int_1 &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; gender &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; conflict &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sub_disorder &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; dev_peer &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sub_exp
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;dev_peer &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;dev_peer &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; gender &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; conflict &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sub_disorder &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; fam_int_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sub_exp
formulas&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;sub_exp &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;sub_exp &lt;span style=&#34;color:#666&#34;&gt;~&lt;/span&gt; gender &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; conflict &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; sub_disorder &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; fam_int_1 &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; dev_peer

meth &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;make.method&lt;/span&gt;(currentDataset)


imputedDataset &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;parlmice&lt;/span&gt;(currentDataset,
  method &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; meth,
  formulas &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; formulas,
  m &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;20&lt;/span&gt;,
  n.core &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;, 
  n.imp.core &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;20&lt;/span&gt;)

&lt;span style=&#34;color:#06287e&#34;&gt;plot&lt;/span&gt;(imputedDataset)
currentDataset &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;complete&lt;/span&gt;(imputedDataset, action &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;long&amp;#34;&lt;/span&gt;, include &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)

&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Causal Mediation Analysis&amp;#34;&lt;/span&gt;

med_res &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; intmed&lt;span style=&#34;color:#666&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#06287e&#34;&gt;mediate&lt;/span&gt;(y &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;sub_disorder&amp;#34;&lt;/span&gt;,
  med &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;dev_peer&amp;#34;&lt;/span&gt; ,&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;sub_exp&amp;#34;&lt;/span&gt;),
  treat &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;fam_int_1&amp;#34;&lt;/span&gt;,
  c &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;gender&amp;#34;&lt;/span&gt; ,&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;conflict&amp;#34;&lt;/span&gt;),
  ymodel &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;logistic regression&amp;#34;&lt;/span&gt;,
  mmodel &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;c&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;logistic regression&amp;#34;&lt;/span&gt; ,&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;logistic regression&amp;#34;&lt;/span&gt;),
  treat_lv &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;, control_lv &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0&lt;/span&gt;, incint &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;, inc_mmint &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;,
  conf.level &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.95&lt;/span&gt;,
  data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; currentDataset, sim &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;1000&lt;/span&gt;, digits &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;3&lt;/span&gt;,
  HTML_report &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;, complete_analysis &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;,
  imputed_data &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;

&lt;h5 id=&#34;using-statsnotebook&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#using-statsnotebook&#34;&gt;Using StatsNotebook&lt;/a&gt;&lt;/h5&gt;
&lt;p&gt;Prior to running the causal mediation analysis, we will need to conduct a &lt;a href=&#34;https://statsnotebook.io/blog/analysis/descriptive/&#34; title=&#34;Descriptive statistics&#34;&gt;descriptive analysis&lt;/a&gt; and it is always a good practice to &lt;a href=&#34;https://statsnotebook.io/blog/dataviz/&#34; title=&#34;dataviz&#34;&gt;visualise the data&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To run a causal mediation analysis,&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Click &lt;strong&gt;Analysis&lt;/strong&gt; at the top&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Causal&lt;/strong&gt; and select &lt;strong&gt;Causal Mediation Analysis&lt;/strong&gt; from the menu&lt;/li&gt;
&lt;li&gt;In the left panel, select &lt;em&gt;sub_disorder&lt;/em&gt; into &lt;em&gt;Outcome&lt;/em&gt;, &lt;em&gt;fam_int&lt;/em&gt; into &lt;em&gt;Exposure&lt;/em&gt;, &lt;em&gt;dev_peer&lt;/em&gt; and &lt;em&gt;sub_exp&lt;/em&gt; into &lt;em&gt;Mediator(s)&lt;/em&gt;, and &lt;em&gt;gender&lt;/em&gt; and &lt;em&gt;conflict&lt;/em&gt; into covariates.
&lt;ul&gt;
&lt;li&gt;We add &lt;em&gt;gender&lt;/em&gt; and &lt;em&gt;conflict&lt;/em&gt; as covariates to adjust for their effects.&lt;/li&gt;
&lt;li&gt;All categorical variables will need to be coded as a &lt;strong&gt;factor&lt;/strong&gt; (such as &lt;em&gt;sub_disorder&lt;/em&gt;, &lt;em&gt;fam_int&lt;/em&gt;, &lt;em&gt;dev_peer&lt;/em&gt;, &lt;em&gt;sub_exp&lt;/em&gt; and &lt;em&gt;gender&lt;/em&gt;. In this example dataset, this has already been done). &lt;a href=&#34;https://statsnotebook.io/blog/data_management/variable_conversion/&#34; title=&#34;variable converstion&#34;&gt;Converting variable type&lt;/a&gt; for step-by-step guide.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/causal_mediation.png&#34; alt=&#34;causal mediation analysis&#34; title=&#34;causal mediation analysis&#34;/&gt;&lt;/a&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;Expand the panel &lt;strong&gt;Analysis Setting&lt;/strong&gt;.
&lt;ul&gt;
&lt;li&gt;Select the models for the mediators and the dependent variable.
&lt;ul&gt;
&lt;li&gt;Linear regression for numeric variable&lt;/li&gt;
&lt;li&gt;Logistic regression for dichotomized variable&lt;/li&gt;
&lt;li&gt;Poisson regression for count variable&lt;/li&gt;
&lt;li&gt;In this example, since the mediators and the dependent variable are dichotomized, select &lt;strong&gt;Logistic regression (Dichotomized variable)&lt;/strong&gt; for &lt;em&gt;sub_disorder&lt;/em&gt;, &lt;em&gt;dev_peer&lt;/em&gt; and &lt;em&gt;sub_exp&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Select &lt;strong&gt;1&lt;/strong&gt; as the treatment level and &lt;strong&gt;0&lt;/strong&gt; as the control level.
&lt;ul&gt;
&lt;li&gt;If the independent variable is a numeric variable, type 1 for treatment level and 0 for control level.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Select the &lt;strong&gt;100&lt;/strong&gt; as the number of simulations.
&lt;ul&gt;
&lt;li&gt;100 is good for an initial assessment of the mediation effect. For final analysis, use at least 1000 simulations.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Since there are missing data in this dataset, click &lt;strong&gt;Impute missing data&lt;/strong&gt;, and input &lt;strong&gt;20&lt;/strong&gt; as the number of imputations.
&lt;ul&gt;
&lt;li&gt;As a rule of thumb, the number of imputations should be around the percentage of missing data.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;img src=&#34;https://statsnotebook.io/blog/analysis/img/mediation_setting.png&#34; alt=&#34;mediation analysis setting&#34; title=&#34;mediation analysis setting&#34;/&gt;&lt;/a&gt;

&lt;h5 id=&#34;interpretation&#34; class=&#34;anchor-link&#34;&gt;&lt;a href=&#34;#interpretation&#34;&gt;Interpretation&lt;/a&gt;&lt;/h5&gt;
&lt;p&gt;Below is the output from &lt;strong&gt;StatsNotebook&lt;/strong&gt;. The analysis is conducted using the &lt;code&gt;intmed&lt;/code&gt; package and most of the output is self-explanatory.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;There were &lt;span style=&#34;color:#40a070&#34;&gt;25.86&lt;/span&gt;% cases with missing data. Multiple imputation was used to impute missing &lt;span style=&#34;color:#06287e&#34;&gt;data &lt;/span&gt;(Rubin, &lt;span style=&#34;color:#40a070&#34;&gt;2009&lt;/span&gt;) and &lt;span style=&#34;color:#40a070&#34;&gt;20&lt;/span&gt; datasets were imputed using the R package &lt;span style=&#34;color:#06287e&#34;&gt;MICE &lt;/span&gt;(van Buuren, &lt;span style=&#34;color:#40a070&#34;&gt;2010&lt;/span&gt;).

The table below shows the estimates from the key regression models for the mediation analysis.

    variables     m1.b          m1.ci  m1.p    m2.b          m2.ci  m2.p
&lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt; (Intercept)    &lt;span style=&#34;color:#40a070&#34;&gt;0.708&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.388&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.292&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.260&lt;/span&gt;   &lt;span style=&#34;color:#40a070&#34;&gt;0.980&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.536&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.791&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.947&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt;    conflict    &lt;span style=&#34;color:#40a070&#34;&gt;1.220&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.963&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.545&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.099&lt;/span&gt;   &lt;span style=&#34;color:#40a070&#34;&gt;1.213&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.953&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.544&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.117&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;3&lt;/span&gt;  genderMale    &lt;span style=&#34;color:#40a070&#34;&gt;1.234&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.861&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.771&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.252&lt;/span&gt;   &lt;span style=&#34;color:#40a070&#34;&gt;1.156&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.804&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.661&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.434&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;4&lt;/span&gt;   fam_int_1 &lt;span style=&#34;color:#40a070&#34;&gt;0.517&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;***&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.358&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;0.747&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.000&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.539&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.369&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;0.788&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.001&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;5&lt;/span&gt;   dev_peer1     &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;           &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;  &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;    &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;           &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;  &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;6&lt;/span&gt;    sub_exp1     &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;           &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;  &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;    &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;           &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;  &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;
       y.b           y.ci   y.p
&lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.061&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;***&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.019&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;0.200&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.000&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt;    &lt;span style=&#34;color:#40a070&#34;&gt;0.820&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.531&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.267&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.371&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;3&lt;/span&gt;    &lt;span style=&#34;color:#40a070&#34;&gt;1.396&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.779&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;2.501&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.262&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;4&lt;/span&gt;    &lt;span style=&#34;color:#40a070&#34;&gt;0.603&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.331&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.102&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.100&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;4.132&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;***&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;1.891&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;9.031&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.000&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;6&lt;/span&gt;    &lt;span style=&#34;color:#40a070&#34;&gt;1.745&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.739&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;4.123&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.203&lt;/span&gt;

Mediation analysis was performed based on the counter&lt;span style=&#34;color:#666&#34;&gt;-&lt;/span&gt;factual framework and the interventional &lt;span style=&#34;color:#06287e&#34;&gt;effect &lt;/span&gt;(Vansteelandt and Daniel, &lt;span style=&#34;color:#40a070&#34;&gt;2017&lt;/span&gt;; Chan and Leung, &lt;span style=&#34;color:#40a070&#34;&gt;2020&lt;/span&gt;). The analysis was conducted in R using the intmed &lt;span style=&#34;color:#06287e&#34;&gt;package &lt;/span&gt;(Chan and Leung, &lt;span style=&#34;color:#40a070&#34;&gt;2020&lt;/span&gt;) with &lt;span style=&#34;color:#40a070&#34;&gt;1000&lt;/span&gt; simulations.

                                                 effect    est               ci
&lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;                    indirect effect through mediator &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;-0.018&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;-0.037&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;-0.004&lt;/span&gt;)
&lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt;                    indirect effect through mediator &lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;-0.007&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;-0.021&lt;/span&gt;,  &lt;span style=&#34;color:#40a070&#34;&gt;0.004&lt;/span&gt;)
&lt;span style=&#34;color:#40a070&#34;&gt;3&lt;/span&gt; indirect effect through interaction between mediators  &lt;span style=&#34;color:#40a070&#34;&gt;0.001&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;-0.002&lt;/span&gt;,  &lt;span style=&#34;color:#40a070&#34;&gt;0.005&lt;/span&gt;)
&lt;span style=&#34;color:#40a070&#34;&gt;4&lt;/span&gt;  indirect effect through dependence between mediators  &lt;span style=&#34;color:#40a070&#34;&gt;0.000&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;-0.009&lt;/span&gt;,  &lt;span style=&#34;color:#40a070&#34;&gt;0.009&lt;/span&gt;)
&lt;span style=&#34;color:#40a070&#34;&gt;5&lt;/span&gt;                                         direct effect &lt;span style=&#34;color:#40a070&#34;&gt;-0.055&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;-0.120&lt;/span&gt;,  &lt;span style=&#34;color:#40a070&#34;&gt;0.010&lt;/span&gt;)
&lt;span style=&#34;color:#40a070&#34;&gt;6&lt;/span&gt;                                          total effect &lt;span style=&#34;color:#40a070&#34;&gt;-0.077&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;-0.143&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;-0.016&lt;/span&gt;)
&lt;span style=&#34;color:#40a070&#34;&gt;7&lt;/span&gt;               proportion of effect through mediator &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;  &lt;span style=&#34;color:#40a070&#34;&gt;0.218&lt;/span&gt;                 
&lt;span style=&#34;color:#40a070&#34;&gt;8&lt;/span&gt;               proportion of effect through mediator &lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt;  &lt;span style=&#34;color:#40a070&#34;&gt;0.078&lt;/span&gt;                 
      p
&lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.005&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.202&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.448&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;4&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.975&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.099&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.011&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;7&lt;/span&gt;      
&lt;span style=&#34;color:#40a070&#34;&gt;8&lt;/span&gt;      

Reference
Rubin DB. Multiple imputation for nonresponse in surveys. New York&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt; John Wiley &lt;span style=&#34;color:#666&#34;&gt;&amp;amp;&lt;/span&gt; Sons; &lt;span style=&#34;color:#40a070&#34;&gt;2009&lt;/span&gt;.
Buuren Sv, Groothuis&lt;span style=&#34;color:#666&#34;&gt;-&lt;/span&gt;Oudshoorn K. mice&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt; Multivariate imputation by chained equations in R. Journal of statistical software. &lt;span style=&#34;color:#40a070&#34;&gt;2010&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#40a070&#34;&gt;1-68&lt;/span&gt;.
Vansteelandt S, Daniel RM. Interventional effects for mediation analysis with multiple mediators. &lt;span style=&#34;color:#06287e&#34;&gt;Epidemiology &lt;/span&gt;(Cambridge, Mass). 2017; &lt;span style=&#34;color:#40a070&#34;&gt;28&lt;/span&gt;(&lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt;)&lt;span style=&#34;color:#666&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#40a070&#34;&gt;258&lt;/span&gt;.
Chan G, Leung J. Causal mediation analysis using the interventional effect approach. A refined definition. Paper uner review. &lt;span style=&#34;color:#40a070&#34;&gt;2020&lt;/span&gt;.

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;
&lt;p&gt;There are two key sections of the output: Results from regression models and Results from mediation analysis.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Results from regression models&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Behind the scene, three key regression models are run.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;em&gt;dev_peer&lt;/em&gt; (mediator) is regressed on &lt;em&gt;fam_int&lt;/em&gt; (independent variable), &lt;em&gt;gender&lt;/em&gt; and &lt;em&gt;conflict&lt;/em&gt; in a logistic regression
&lt;ul&gt;
&lt;li&gt;This is to assess the effect of &lt;em&gt;fam_int&lt;/em&gt; on &lt;em&gt;dev_peer&lt;/em&gt;, adjusting for &lt;em&gt;gender&lt;/em&gt; and &lt;em&gt;conflict&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;em&gt;sub_exp&lt;/em&gt; (mediator) is regressed on &lt;em&gt;fam_int&lt;/em&gt; (independent variable), &lt;em&gt;gender&lt;/em&gt; and &lt;em&gt;conflict&lt;/em&gt; in a logsitic regression
&lt;ul&gt;
&lt;li&gt;This is to assess the effect of &lt;em&gt;fam_int&lt;/em&gt; on &lt;em&gt;dev_peer&lt;/em&gt;, adjusting for &lt;em&gt;gender&lt;/em&gt; and &lt;em&gt;conflict&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;em&gt;sub_disorder&lt;/em&gt; (dependent variable) is regressed on &lt;em&gt;dev_peer&lt;/em&gt; (mediator), &lt;em&gt;sub_exp&lt;/em&gt; (mediator), &lt;em&gt;fam_int&lt;/em&gt; (indenpendent variable), &lt;em&gt;gender&lt;/em&gt; and &lt;em&gt;conflict&lt;/em&gt; in a logistic regression.
&lt;ul&gt;
&lt;li&gt;This is to assess the effect of &lt;em&gt;dev_peer&lt;/em&gt;, &lt;em&gt;sub_exp&lt;/em&gt; and &lt;em&gt;fam_int&lt;/em&gt; on &lt;em&gt;sub_disorder&lt;/em&gt;, adjusting for &lt;em&gt;gender&lt;/em&gt; and &lt;em&gt;conflict&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The table below from the &lt;strong&gt;StatsNotebook&lt;/strong&gt; summarises the odds ratio, 95% confidence intervals and p-value from these three models. With a significance level of 0.05, the results indicate that participation in family intervention reduces the odds of engagement with deviant peers, OR = 0.517, 95% CI (0.358, 0.747) and experimentation with drugs, OR = 0.539, 95% CI (0.369, 0.788). Family intervention may reduce odds of substance use disorder directly, OR = 0.603, 95% CI (0.331, 1.102), but this effect is not statistically significant. Engagement with deviant peers increased the odds of substance use disorder, OR = 4.132, 95% CI (1.891, 9.031). Experimentation with drugs may increase the odds of substance use disorder, OR = 1.745, 95% CI (0.739, 4.123), but this effect is not statistically significant.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;The table below shows the estimates from the key regression models for the mediation analysis.

    variables     m1.b          m1.ci  m1.p    m2.b          m2.ci  m2.p
&lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt; (Intercept)    &lt;span style=&#34;color:#40a070&#34;&gt;0.708&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.388&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.292&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.260&lt;/span&gt;   &lt;span style=&#34;color:#40a070&#34;&gt;0.980&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.536&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.791&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.947&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt;    conflict    &lt;span style=&#34;color:#40a070&#34;&gt;1.220&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.963&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.545&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.099&lt;/span&gt;   &lt;span style=&#34;color:#40a070&#34;&gt;1.213&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.953&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.544&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.117&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;3&lt;/span&gt;  genderMale    &lt;span style=&#34;color:#40a070&#34;&gt;1.234&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.861&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.771&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.252&lt;/span&gt;   &lt;span style=&#34;color:#40a070&#34;&gt;1.156&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.804&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.661&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.434&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;4&lt;/span&gt;   fam_int_1 &lt;span style=&#34;color:#40a070&#34;&gt;0.517&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;***&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.358&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;0.747&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.000&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.539&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.369&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;0.788&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.001&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;5&lt;/span&gt;   dev_peer1     &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;           &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;  &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;    &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;           &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;  &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;6&lt;/span&gt;    sub_exp1     &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;           &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;  &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;    &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;           &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;  &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;NA&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;
       y.b           y.ci   y.p
&lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.061&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;***&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.019&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;0.200&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.000&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt;    &lt;span style=&#34;color:#40a070&#34;&gt;0.820&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.531&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.267&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.371&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;3&lt;/span&gt;    &lt;span style=&#34;color:#40a070&#34;&gt;1.396&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.779&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;2.501&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.262&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;4&lt;/span&gt;    &lt;span style=&#34;color:#40a070&#34;&gt;0.603&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.331&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1.102&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.100&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;4.132&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;***&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;1.891&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;9.031&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.000&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;6&lt;/span&gt;    &lt;span style=&#34;color:#40a070&#34;&gt;1.745&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;0.739&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;4.123&lt;/span&gt;) &lt;span style=&#34;color:#40a070&#34;&gt;0.203&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;
&lt;p&gt;&lt;strong&gt;Results from mediation analysis&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The second table shows the results from mediation analysis.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;Mediation analysis was performed based on the counter&lt;span style=&#34;color:#666&#34;&gt;-&lt;/span&gt;factual framework and the interventional &lt;span style=&#34;color:#06287e&#34;&gt;effect &lt;/span&gt;(Vansteelandt and Daniel, &lt;span style=&#34;color:#40a070&#34;&gt;2017&lt;/span&gt;; Chan and Leung, &lt;span style=&#34;color:#40a070&#34;&gt;2020&lt;/span&gt;). The analysis was conducted in R using the intmed &lt;span style=&#34;color:#06287e&#34;&gt;package &lt;/span&gt;(Chan and Leung, &lt;span style=&#34;color:#40a070&#34;&gt;2020&lt;/span&gt;) with &lt;span style=&#34;color:#40a070&#34;&gt;1000&lt;/span&gt; simulations.

                                                 effect    est               ci
&lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;                    indirect effect through mediator &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;-0.018&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;-0.037&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;-0.004&lt;/span&gt;)
&lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt;                    indirect effect through mediator &lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;-0.007&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;-0.021&lt;/span&gt;,  &lt;span style=&#34;color:#40a070&#34;&gt;0.004&lt;/span&gt;)
&lt;span style=&#34;color:#40a070&#34;&gt;3&lt;/span&gt; indirect effect through interaction between mediators  &lt;span style=&#34;color:#40a070&#34;&gt;0.001&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;-0.002&lt;/span&gt;,  &lt;span style=&#34;color:#40a070&#34;&gt;0.005&lt;/span&gt;)
&lt;span style=&#34;color:#40a070&#34;&gt;4&lt;/span&gt;  indirect effect through dependence between mediators  &lt;span style=&#34;color:#40a070&#34;&gt;0.000&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;-0.009&lt;/span&gt;,  &lt;span style=&#34;color:#40a070&#34;&gt;0.009&lt;/span&gt;)
&lt;span style=&#34;color:#40a070&#34;&gt;5&lt;/span&gt;                                         direct effect &lt;span style=&#34;color:#40a070&#34;&gt;-0.055&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;-0.120&lt;/span&gt;,  &lt;span style=&#34;color:#40a070&#34;&gt;0.010&lt;/span&gt;)
&lt;span style=&#34;color:#40a070&#34;&gt;6&lt;/span&gt;                                          total effect &lt;span style=&#34;color:#40a070&#34;&gt;-0.077&lt;/span&gt; (&lt;span style=&#34;color:#40a070&#34;&gt;-0.143&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;-0.016&lt;/span&gt;)
&lt;span style=&#34;color:#40a070&#34;&gt;7&lt;/span&gt;               proportion of effect through mediator &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;  &lt;span style=&#34;color:#40a070&#34;&gt;0.218&lt;/span&gt;                 
&lt;span style=&#34;color:#40a070&#34;&gt;8&lt;/span&gt;               proportion of effect through mediator &lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt;  &lt;span style=&#34;color:#40a070&#34;&gt;0.078&lt;/span&gt;                 
      p
&lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.005&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.202&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.448&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;4&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.975&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.099&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0.011&lt;/span&gt;
&lt;span style=&#34;color:#40a070&#34;&gt;7&lt;/span&gt;      
&lt;span style=&#34;color:#40a070&#34;&gt;8&lt;/span&gt;      

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;
&lt;p&gt;Since &lt;em&gt;sub_disorder&lt;/em&gt; is a dichotomised variable, the estimates are in a &lt;strong&gt;probability scale&lt;/strong&gt;. Overall, the total effect of &lt;em&gt;fam_int&lt;/em&gt; is -0.077, indicating that participation in family intervention reduces the probability of &lt;em&gt;sub_disorder&lt;/em&gt; by 0.077 (i.e. 7.7%). Of this total effect, 0.018 (est = -0.018, 95% CI [-0.037, -0.004]) is significantly mediated through &lt;em&gt;dev_peer&lt;/em&gt; and 0.007 (est = -0.007, 95% CI [-0.021, 0.004]) is mediated through &lt;em&gt;sub_exp&lt;/em&gt;. Overall, it is estimated that 21.8% of the total effect is mediated through &lt;em&gt;dev_peer&lt;/em&gt; and 7.8% through &lt;em&gt;sub_exp&lt;/em&gt;.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>