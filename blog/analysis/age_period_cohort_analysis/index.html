<!DOCTYPE html>
<html lang="en-us">
    <head>
        
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="description" content="StatsNotebook is an open source statistical package based on R.">
<title>
Age Period Cohort Analysis - StatsNotebook - Simple. Powerful. Reproducible.
</title>



        <meta property="og:title" content="Age-period-cohort analysis - StatsNotebook - Simple. Powerful. Reproducible." />
<meta property="og:type" content="website" />
<meta property="og:description" content="StatsNotebook is an open source statistical package based on R."/>
<meta property="og:url" content="https://statsnotebook.io/blog/analysis/age_period_cohort_analysis/"/>
<meta property="og:site_name" content="StatsNotebook - Simple. Powerful. Reproducible."/>




<meta property="og:image" content="https://statsnotebook.io/home/profile.jpg"/>




        
<link rel="shortcut icon" href="/img/fav.ico">


        





<link rel="stylesheet" href="/css/main.min.c285da496bdc6eb125783ccd84751cbcdd365cb368c74109eccf557310b03bf7.css" integrity="sha256-woXaSWvcbrEleDzNhHUcvN02XLNox0EJ7M9VcxCwO/c=" crossorigin="anonymous" media="screen">





        
        
        
        
    </head>
    <body>
        <section id="top" class="section">
            
            <div class="container hero  fade-in one ">
                

<h1 class="bold-title is-1">StatsNotebook</h1>


            </div>
            
            <div class="section  fade-in two ">
                
<div class="container">
    <hr>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        
        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false" >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
        <div class="navbar-menu " id="navMenu">
            
            
            
            
            <a class="navbar-item" href="/">
                
                Home
                
            </a>
            
            
            
            <a class="navbar-item" href="/about">
                
                About
                
            </a>
            
            
            
            <a class="navbar-item" href="/blog/analysis">
                
                Analysis Tutorials
                
            </a>
            
            
            
            <a class="navbar-item" href="/blog/dataviz">
                
                Data Viz Tutorials
                
            </a>
            
            
            
            <a class="navbar-item" href="/blog">
                
                Blog
                
            </a>
            
            
            
            <a class="navbar-item" href="/download">
                
                Download
                
            </a>
            
            
            
            <a class="navbar-item" href="/consultation">
                
                Training and consultation
                
            </a>
            
            
            
        </div>
    </nav>
    <hr>
</div>



                
<div class="container">
    <h2 class="title is-1 top-pad strong-post-title">
        <a href="https://statsnotebook.io/blog/analysis/age_period_cohort_analysis/">Age-period-cohort analysis</a>
    </h2>
    <div class="post-data">
        29 Mar, 2021 |
        12 minutes read
    </div>
    
    <div class="blog-share">
        Share this:
        
        <a class="twitter-share-button" href="https://twitter.com/intent/tweet?text=Age-period-cohort%20analysis%20https%3a%2f%2fstatsnotebook.io%2fblog%2fanalysis%2fage_period_cohort_analysis%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <i class="fab fa-twitter"></i>
            <span class="hidden">Twitter</span>
        </a>
        
        
        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fstatsnotebook.io%2fblog%2fanalysis%2fage_period_cohort_analysis%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <i class="fab fa-facebook-f"></i>
            <span class="hidden">Facebook</span>
        </a>
        
        
        
    </div>
    
    
    
    <p>
        Tags:
        
        <a href="/tags/analysis">Analysis</a>,
        
        <a href="/tags/r-code">R code</a>,
        
        <a href="/tags/linear-model">Linear model</a>,
        
        <a href="/tags/regression">Regression</a>
        
    </p>
    
	<br/>
	<p><strong>Follow <a href="https://www.facebook.com/StatsNotebook/">our Facebook page</a> or <a href="https://twitter.com/GaryCKChan">our developer&rsquo;s Twitter</a> for more tutorials and future updates.</strong></p>
</div>

<div class="container markdown top-pad">
    <p>The tutorial is based on <a href="https://r-project.org" title="The R project for statistical computing">R</a> and <a href="https://statsnotebook.io" title="StatsNotebook">StatsNotebook</a>, a graphical interface for R. Visit our <a href="https://statsnotebook.io/blog/analysis/">Analysis section</a> for other tutorials.</p>
<p>Epidemiologists and social scientists often apply Age-Period-Cohort analysis to disentangle trends of social/health behvaiors into three components.</p>
<ol>
<li>Age effect - This represents the effect associated with chronological age. For example, young people are more likely to use cannabis for recreational purpose than older people.</li>
<li>Period effect - This represents the effect associated with time period that affects all age groups at the same time. For example, changes in legislation with regards to recreational cannabis use is like to influence behaviors across all age group.</li>
<li>Cohort effect - Epidemiologists and social scientists are often interested in <em>birth cohort</em>, who experienced the same historical and social events at the same age. Cohort effect thus is often used to refered to the variation due to these unique experiences. For example, the baby boomer generation has a higher rate of cannabis use compared to subsequent cohort at the same age.</li>
</ol>
<p>In this tutorial, we will use a simulalated data based on a nationally representative dataset in Australia and disentangle changes in cannabis use trends into age, period and cohort effect. The challenge of age-period-cohort analysis (APC analysis) has long been identified because the <em>cohort</em> variabls is often directly calcuated from <em>age</em> and <em>period</em> such that</p>
<p>Cohort = Period - Age</p>
<p>In this tutorial, we will use the Hierarchical APC-Corss-Classified Random Effect Model (HACP-CCREM; Yang et al, 2008) to test the age, period and cohort effect on weekly cannabis use. This model is a type of mixed effect model in which the <em>Age</em> effect is entered as a fixed effect and both <em>Cohort</em> and <em>Period</em> are entered as random effects. In this setup, the HACP-CCREM is not different from the typical application of mixed model in which the random effects often represent the contextual effects that influence the outcome. In this case, cohort represents the contextual effect of experiencing the same social and historical context at the same age within the same birth cohort and period effect represents the contextual effect of experiencing the same social and historical context at a certain time period that affects all age group.</p>

<h5 id="example-dataset" class="anchor-link"><a href="#example-dataset">Example dataset</a></h5>
<p>In this tutorial, we will use an example dataset simulated based on a national drug survey in Australia.</p>
<p>This data can be loaded using the following code.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#06287e">library</span>(tidyverse)
currentDataset <span style="color:#666">&lt;-</span> <span style="color:#06287e">read_csv</span>(<span style="color:#4070a0">&#34;https://statsnotebook.io/blog/data_management/example_data/APC_cannabis.csv&#34;</span>)
</code></pre></div><p>Supposed that the data was collected every three years between 2001 and 2019, there were 7 repeated cross-sectional surveys.</p>
<p>In this dataset, there are 8 variables.</p>
<ol>
<li>Sex - 1: Male; 2: Female</li>
<li>HighSchool - 0: Not completed high school; 1: completed high school</li>
<li>remoteness - 1: Major cities; 2: Inner regional area; 3: Remote area</li>
<li>Year - Year the data was collected: 2001/2004/2007/2010/2013/2016/2019</li>
<li>cohort_cat - Birth cohort: 1: 1941/50; 2: 1951/60; 3: 1961/70; 4: 1971/80; 5: 1981/90; 6: 1991/2000</li>
<li>weekly_cannabis - Weekly cannabis use: 0: No; 1: Yes</li>
<li>AgeR - Recoded age. The value is calculated by dividing the actual age by 10. This is to facilitate model converence when we add the quadratic term of age into the model.</li>
</ol>
<img src="https://statsnotebook.io/blog/analysis/img/apc_data.png" alt="example APC data" title="example APC data"/></a>

<h5 id="age-period-cohort-model" class="anchor-link"><a href="#age-period-cohort-model">Age-Period-Cohort model</a></h5>
<p>In this example, we will test the age, period and cohort effect on weekly cannabis use. Since weekly cannabis use is a dichotomized variable (Yes/No), we will firstly fit a mixed effects (multilevel level) logistic model</p>
<p>At level 1, we have</p>
<p><em>logit</em> P(cannabis<sub>ijk</sub>) = b<sub>0jk</sub>+b<sub>1</sub>Age<sub>ijk</sub>+b<sub>2</sub>Age<sup>2</sup><sub>ijk</sub>+b<sub>3</sub>Female<sub>ijk</sub>+b<sub>4</sub>Inner regional<sub>ijk</sub>+b<sub>5</sub>Remote area<sub>ijk</sub>+b<sub>6</sub>High School<sub>ijk</sub></p>
<p>where <em>Female</em>, <em>Inner regional</em>, <em>Remote area</em> and <em>High School</em> are indicator variables (i.e. <em>High School</em> = 0 for participants who haven&rsquo;t finished high school and <em>High School</em> = 1 for participants who finished high school). R will automatically create these indicator variables when a categorical/factor variable is entered into a model. The quadratic term of age is included to capture the potential quadratic effect of age.</p>
<p>At level 2, we have</p>
<p>b<sub>0jk</sub> = γ<sub>0</sub>+ u<sub>0j</sub> + v<sub>0k</sub></p>
<p>where u<sub>0j</sub> and v<sub>0k</sub> represents the effect of being in period <em>j</em> and birth cohort <em>k</em>, and u<sub>0j</sub> ~ N(0, τ<sub>u</sub>) and v<sub>0j</sub> ~ N(0, τ<sub>v</sub>). The u<sub>0j</sub> and v<sub>0k</sub> have also been referred to as the random effect of period and cohort. It should be noted that the index <em>ijk</em> is the index for individual <em>i</em> in period <em>j</em> and cohort <em>k</em>.</p>

<h5 id="apc-analysis-in-statsnotebook" class="anchor-link"><a href="#apc-analysis-in-statsnotebook">APC analysis in StatsNotebook</a></h5>
<p>In this analysis, after loading the data, we will need to</p>
<ol>
<li>convert the variable <em>Sex</em>, <em>HighSchool</em>, <em>remoteness</em>, <em>Year</em>, and <em>cohort_cat</em> into factor variables;</li>
<li>centre the age variable at 2 so that the intercept of the model represented the effect of age at 20 years old (i.e. substracting 2 from the age variable); and</li>
<li>create the quadratic term of age, <em>AgeR2</em>.</li>
</ol>
<p>**See <a href="https://statsnotebook.io/blog/data_management/variable_conversion/" title="variable converstion">Converting variable type</a> and <a href="https://statsnotebook.io/blog/data_management/compute_variable/#quadratic-term" title="Creating quadratic term">Converting variable type</a> for a step-by-step guide.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#60a0b0;font-style:italic">#Converting Sex, HighSchool, Year, cohort_cat and remoteness into factor variable</span>
currentDataset<span style="color:#666">$</span>Sex <span style="color:#666">&lt;-</span> <span style="color:#06287e">factor</span>(currentDataset<span style="color:#666">$</span>Sex, exclude <span style="color:#666">=</span> <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;&#34;</span>, <span style="color:#007020;font-weight:bold">NA</span>))
currentDataset<span style="color:#666">$</span>HighSchool <span style="color:#666">&lt;-</span> <span style="color:#06287e">factor</span>(currentDataset<span style="color:#666">$</span>HighSchool, exclude <span style="color:#666">=</span> <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;&#34;</span>, <span style="color:#007020;font-weight:bold">NA</span>))
currentDataset<span style="color:#666">$</span>Year <span style="color:#666">&lt;-</span> <span style="color:#06287e">factor</span>(currentDataset<span style="color:#666">$</span>Year, exclude <span style="color:#666">=</span> <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;&#34;</span>, <span style="color:#007020;font-weight:bold">NA</span>))
currentDataset<span style="color:#666">$</span>cohort_cat <span style="color:#666">&lt;-</span> <span style="color:#06287e">factor</span>(currentDataset<span style="color:#666">$</span>cohort_cat, exclude <span style="color:#666">=</span> <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;&#34;</span>, <span style="color:#007020;font-weight:bold">NA</span>))
currentDataset<span style="color:#666">$</span>remoteness <span style="color:#666">&lt;-</span> <span style="color:#06287e">factor</span>(currentDataset<span style="color:#666">$</span>remoteness, exclude <span style="color:#666">=</span> <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;&#34;</span>, <span style="color:#007020;font-weight:bold">NA</span>))

<span style="color:#60a0b0;font-style:italic">#centre age at 20 years old and create the quadratic term</span>
currentDataset<span style="color:#666">$</span>AgeR <span style="color:#666">=</span> currentDataset<span style="color:#666">$</span>AgeR <span style="color:#666">-</span> <span style="color:#40a070">2</span>
currentDataset<span style="color:#666">$</span>AgeR2 <span style="color:#666">=</span> currentDataset<span style="color:#666">$</span>AgeR^2
</code></pre></div><br/>
<p>To fit a Age-Period-Cohort model,</p>
<ol>
<li>Click <strong>Analysis</strong> at the top</li>
<li>Click <strong>Regression</strong> and select <strong>Logistic Regression (Binary outcome)</strong> from the menu</li>
<li>In the left panel, select <em>weekly_cannabis</em> into <em>outcome</em>, <em>AgeR</em>, <em>AgeR2</em> (the newly created quadratic term of <em>AgeR</em>), <em>Sex</em>, <em>HighSchool</em> and <em>remoteness</em> into <em>Covariates</em>, and select <em>cohort_cat</em> and <em>Year</em> into <em>Random Effect</em>.</li>
<li>Click <strong>Code and Run</strong></li>
</ol>
<img src="https://statsnotebook.io/blog/analysis/img/apc_instruction1.png" alt="age-period-cohort analysis instruction 1" title="age-period-cohort analysis instruction 1"/></a>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#06287e">library</span>(lme4)

res <span style="color:#666">&lt;-</span> <span style="color:#06287e">glmer</span>(weekly_cannabis <span style="color:#666">~</span> AgeR <span style="color:#666">+</span> AgeR2 <span style="color:#666">+</span> Sex <span style="color:#666">+</span> remoteness <span style="color:#666">+</span> HighSchool <span style="color:#666">+</span> (<span style="color:#40a070">1</span> <span style="color:#666">|</span> cohort_cat) <span style="color:#666">+</span> (<span style="color:#40a070">1</span> <span style="color:#666">|</span> Year),
  family <span style="color:#666">=</span> binomial,
  data <span style="color:#666">=</span> currentDataset)
<span style="color:#06287e">summary</span>(res)
<span style="color:#06287e">confint</span>(res, level <span style="color:#666">=</span> <span style="color:#40a070">0.95</span>, method <span style="color:#666">=</span> <span style="color:#4070a0">&#34;Wald&#34;</span>)

se <span style="color:#666">&lt;-</span> <span style="color:#06287e">sqrt</span>(<span style="color:#06287e">diag</span>(<span style="color:#06287e">vcov</span>(res)))
z <span style="color:#666">&lt;-</span> <span style="color:#666">-</span><span style="color:#06287e">qnorm</span>((<span style="color:#40a070">1-0.95</span>)<span style="color:#666">/</span><span style="color:#40a070">2</span>)
<span style="color:#06287e">exp</span>(<span style="color:#06287e">cbind</span>(Est<span style="color:#666">=</span><span style="color:#06287e">fixef</span>(res),
  <span style="color:#4070a0">&#34;2.5%&#34;</span>  <span style="color:#666">=</span> <span style="color:#06287e">fixef</span>(res) <span style="color:#666">-</span> z<span style="color:#666">*</span>se,
  <span style="color:#4070a0">&#34;97.5%&#34;</span> <span style="color:#666">=</span> <span style="color:#06287e">fixef</span>(res) <span style="color:#666">+</span> z<span style="color:#666">*</span>se))


<span style="color:#4070a0">&#34;Chan, G. and StatsNotebook Team (2020). StatsNotebook. (Version 0.1.1) [Computer Software]. Retrieved from https://www.statsnotebook.io&#34;</span>
<span style="color:#4070a0">&#34;R Core Team (2020). The R Project for Statistical Computing. [Computer software]. Retrieved from https://r-project.org&#34;</span>
</code></pre></div><br/>

<h5 id="r-codes-explained" class="anchor-link"><a href="#r-codes-explained">R codes explained</a></h5>
<p>The Age-Period-Cohort model in this example is a mixed effects logistic model with random intercepts. The following are from the top section of the generated codes. The analysis uses the <code>glmer</code> function from the  <code>lme4</code> library to fit the model, the <code>summary</code> function to display the model output, and then the <code>confint</code> function to compute the confidence intervals of the parameters using the Wald&rsquo;s method.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#06287e">library</span>(lme4)

res <span style="color:#666">&lt;-</span> <span style="color:#06287e">glmer</span>(weekly_cannabis <span style="color:#666">~</span> AgeR <span style="color:#666">+</span> AgeR2 <span style="color:#666">+</span> Sex <span style="color:#666">+</span> remoteness <span style="color:#666">+</span> HighSchool <span style="color:#666">+</span> (<span style="color:#40a070">1</span> <span style="color:#666">|</span> cohort_cat) <span style="color:#666">+</span> (<span style="color:#40a070">1</span> <span style="color:#666">|</span> Year),
  family <span style="color:#666">=</span> binomial,
  data <span style="color:#666">=</span> currentDataset)
<span style="color:#06287e">summary</span>(res)
<span style="color:#06287e">confint</span>(res, level <span style="color:#666">=</span> <span style="color:#40a070">0.95</span>, method <span style="color:#666">=</span> <span style="color:#4070a0">&#34;Wald&#34;</span>)
</code></pre></div><p>The next section of the codes extracts the variance-covariance matrix of the parameters, and calculate the odds ratio and the corresponding confidence intervals of each variable.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">se <span style="color:#666">&lt;-</span> <span style="color:#06287e">sqrt</span>(<span style="color:#06287e">diag</span>(<span style="color:#06287e">vcov</span>(res)))
z <span style="color:#666">&lt;-</span> <span style="color:#666">-</span><span style="color:#06287e">qnorm</span>((<span style="color:#40a070">1-0.95</span>)<span style="color:#666">/</span><span style="color:#40a070">2</span>)
<span style="color:#06287e">exp</span>(<span style="color:#06287e">cbind</span>(Est<span style="color:#666">=</span><span style="color:#06287e">fixef</span>(res),
  <span style="color:#4070a0">&#34;2.5%&#34;</span>  <span style="color:#666">=</span> <span style="color:#06287e">fixef</span>(res) <span style="color:#666">-</span> z<span style="color:#666">*</span>se,
  <span style="color:#4070a0">&#34;97.5%&#34;</span> <span style="color:#666">=</span> <span style="color:#06287e">fixef</span>(res) <span style="color:#666">+</span> z<span style="color:#666">*</span>se))
</code></pre></div><p>The following are excerpt of outputs from the above codes.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">Fixed effects<span style="color:#666">:</span>
            Estimate Std. Error z value <span style="color:#06287e">Pr</span>(<span style="color:#666">&gt;|</span>z<span style="color:#666">|</span>)    
(Intercept) <span style="color:#40a070">-1.47823</span>    <span style="color:#40a070">0.19175</span>  <span style="color:#40a070">-7.709</span> <span style="color:#40a070">1.27e-14</span> <span style="color:#666">***</span>
AgeR        <span style="color:#40a070">-0.49014</span>    <span style="color:#40a070">0.06268</span>  <span style="color:#40a070">-7.819</span> <span style="color:#40a070">5.32e-15</span> <span style="color:#666">***</span>
AgeR2        <span style="color:#40a070">0.01221</span>    <span style="color:#40a070">0.01186</span>   <span style="color:#40a070">1.030</span>    <span style="color:#40a070">0.303</span>    
Sex2        <span style="color:#40a070">-0.84691</span>    <span style="color:#40a070">0.03172</span> <span style="color:#40a070">-26.697</span>  <span style="color:#666">&lt;</span> <span style="color:#40a070">2e-16</span> <span style="color:#666">***</span>
remoteness2  <span style="color:#40a070">0.14050</span>    <span style="color:#40a070">0.03362</span>   <span style="color:#40a070">4.179</span> <span style="color:#40a070">2.93e-05</span> <span style="color:#666">***</span>
remoteness3  <span style="color:#40a070">0.30242</span>    <span style="color:#40a070">0.05130</span>   <span style="color:#40a070">5.895</span> <span style="color:#40a070">3.74e-09</span> <span style="color:#666">***</span>
HighSchool1 <span style="color:#40a070">-0.85670</span>    <span style="color:#40a070">0.03230</span> <span style="color:#40a070">-26.521</span>  <span style="color:#666">&lt;</span> <span style="color:#40a070">2e-16</span> <span style="color:#666">***</span>
</code></pre></div><p>The following are odds ratio calculated by exponentiating the model parameters.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">                  Est      <span style="color:#40a070">2.5</span><span style="color:#666">%     97.5%</span>
(Intercept) <span style="color:#40a070">0.2280404</span> <span style="color:#40a070">0.1566014</span> <span style="color:#40a070">0.3320687</span>
AgeR        <span style="color:#40a070">0.6125418</span> <span style="color:#40a070">0.5417249</span> <span style="color:#40a070">0.6926162</span>
AgeR2       <span style="color:#40a070">1.0122856</span> <span style="color:#40a070">0.9890264</span> <span style="color:#40a070">1.0360917</span>
Sex2        <span style="color:#40a070">0.4287377</span> <span style="color:#40a070">0.4028924</span> <span style="color:#40a070">0.4562409</span>
remoteness2 <span style="color:#40a070">1.1508512</span> <span style="color:#40a070">1.0774569</span> <span style="color:#40a070">1.2292450</span>
remoteness3 <span style="color:#40a070">1.3531320</span> <span style="color:#40a070">1.2236971</span> <span style="color:#40a070">1.4962576</span>
HighSchool1 <span style="color:#40a070">0.4245599</span> <span style="color:#40a070">0.3985133</span> <span style="color:#40a070">0.4523089</span>
</code></pre></div><p>As expected, age is strongly associated with reduced odds of using cannabis weekly. The quadratic term of age is not statistically significant and is very close to zero.</p>
<p>In the presence of the quadratic term of age and other variables in the model, to better understand the effect of age on cannabis use, we can use the <code>emmeans</code> package to calculate the probability of weekly cannabis use with the following codes.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#06287e">library</span>(emmeans)

Age_eff <span style="color:#666">=</span> <span style="color:#06287e">data.frame</span>()

<span style="color:#60a0b0;font-style:italic"># Age is centred at 20 years old, and is divided by 10.</span>
<span style="color:#60a0b0;font-style:italic"># (i.e. 0 means the participant is 20 years old, 1 means 30 years old, etc)</span>
<span style="color:#60a0b0;font-style:italic"># We use a for loop to calculate the probability of weekly cannabis use </span>
<span style="color:#60a0b0;font-style:italic"># when the age &#34;score&#34; is between 0 and 5, with 0.5 increment.</span>
<span style="color:#60a0b0;font-style:italic"># The calculated probability is stored in a new data frame Age_eff</span>

<span style="color:#06287e">for </span>(i in <span style="color:#40a070">0</span><span style="color:#666">:</span><span style="color:#40a070">10</span>) {
  emm <span style="color:#666">&lt;-</span> <span style="color:#06287e">emmeans</span>(res,  <span style="color:#666">~</span> AgeR <span style="color:#666">+</span> AgeR2,
  at <span style="color:#666">=</span> <span style="color:#06287e">list</span>(
  AgeR <span style="color:#666">=</span> i<span style="color:#666">/</span><span style="color:#40a070">2</span>, AgeR2 <span style="color:#666">=</span> (i<span style="color:#666">/</span><span style="color:#40a070">2</span>)^2), type <span style="color:#666">=</span> <span style="color:#4070a0">&#34;response&#34;</span>, level <span style="color:#666">=</span> <span style="color:#40a070">0.95</span>)
  Age_eff <span style="color:#666">=</span> <span style="color:#06287e">rbind</span>(<span style="color:#06287e">data.frame</span>(<span style="color:#06287e">summary</span>(emm)), Age_eff)
}
</code></pre></div><br/>
<p>The above codes prodce the following output. This can be considered as the &ldquo;average&rdquo; probability averaging across other variables. Note that a score of &ldquo;0&rdquo; for age represents 20 years old and a score of &ldquo;5&rdquo; represents 70 years old. The column <em>prob</em> is the estimated probability of weekly cannabis use averaged across levels of sex, remoteness, and high school completion.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">   AgeR AgeR2       prob          SE  df   asymp.LCL  asymp.UCL
<span style="color:#40a070">1</span>   <span style="color:#40a070">5.0</span> <span style="color:#40a070">25.00</span> <span style="color:#40a070">0.01302441</span> <span style="color:#40a070">0.002963280</span> <span style="color:#007020;font-weight:bold">Inf</span> <span style="color:#40a070">0.008329145</span> <span style="color:#40a070">0.02031226</span>
<span style="color:#40a070">2</span>   <span style="color:#40a070">4.5</span> <span style="color:#40a070">20.25</span> <span style="color:#40a070">0.01566169</span> <span style="color:#40a070">0.003206712</span> <span style="color:#007020;font-weight:bold">Inf</span> <span style="color:#40a070">0.010472891</span> <span style="color:#40a070">0.02336060</span>
<span style="color:#40a070">3</span>   <span style="color:#40a070">4.0</span> <span style="color:#40a070">16.00</span> <span style="color:#40a070">0.01893590</span> <span style="color:#40a070">0.003566890</span> <span style="color:#007020;font-weight:bold">Inf</span> <span style="color:#40a070">0.013074952</span> <span style="color:#40a070">0.02735125</span>
<span style="color:#40a070">4</span>   <span style="color:#40a070">3.5</span> <span style="color:#40a070">12.25</span> <span style="color:#40a070">0.02301558</span> <span style="color:#40a070">0.004081239</span> <span style="color:#007020;font-weight:bold">Inf</span> <span style="color:#40a070">0.016237876</span> <span style="color:#40a070">0.03252876</span>
<span style="color:#40a070">5</span>   <span style="color:#40a070">3.0</span>  <span style="color:#40a070">9.00</span> <span style="color:#40a070">0.02811552</span> <span style="color:#40a070">0.004789430</span> <span style="color:#007020;font-weight:bold">Inf</span> <span style="color:#40a070">0.020105526</span> <span style="color:#40a070">0.03918906</span>
<span style="color:#40a070">6</span>   <span style="color:#40a070">2.5</span>  <span style="color:#40a070">6.25</span> <span style="color:#40a070">0.03450870</span> <span style="color:#40a070">0.005735311</span> <span style="color:#007020;font-weight:bold">Inf</span> <span style="color:#40a070">0.024872334</span> <span style="color:#40a070">0.04769591</span>
<span style="color:#40a070">7</span>   <span style="color:#40a070">2.0</span>  <span style="color:#40a070">4.00</span> <span style="color:#40a070">0.04254035</span> <span style="color:#40a070">0.006973858</span> <span style="color:#007020;font-weight:bold">Inf</span> <span style="color:#40a070">0.030786360</span> <span style="color:#40a070">0.05851100</span>
<span style="color:#40a070">8</span>   <span style="color:#40a070">1.5</span>  <span style="color:#40a070">2.25</span> <span style="color:#40a070">0.05264362</span> <span style="color:#40a070">0.008584237</span> <span style="color:#007020;font-weight:bold">Inf</span> <span style="color:#40a070">0.038144305</span> <span style="color:#40a070">0.07224044</span>
<span style="color:#40a070">9</span>   <span style="color:#40a070">1.0</span>  <span style="color:#40a070">1.00</span> <span style="color:#40a070">0.06535550</span> <span style="color:#40a070">0.010690410</span> <span style="color:#007020;font-weight:bold">Inf</span> <span style="color:#40a070">0.047275202</span> <span style="color:#40a070">0.08969955</span>
<span style="color:#40a070">10</span>  <span style="color:#40a070">0.5</span>  <span style="color:#40a070">0.25</span> <span style="color:#40a070">0.08132988</span> <span style="color:#40a070">0.013489649</span> <span style="color:#007020;font-weight:bold">Inf</span> <span style="color:#40a070">0.058509247</span> <span style="color:#40a070">0.11199258</span>
<span style="color:#40a070">11</span>  <span style="color:#40a070">0.0</span>  <span style="color:#40a070">0.00</span> <span style="color:#40a070">0.10134240</span> <span style="color:#40a070">0.017284082</span> <span style="color:#007020;font-weight:bold">Inf</span> <span style="color:#40a070">0.072133577</span> <span style="color:#40a070">0.14058661</span>
</code></pre></div><br/>
<p>We can use the <code>ggplot2</code> library to visualise the age effect using the following codes. See our <a href="https://statsnotebook.io/blog/dataviz/" title="DataViz">Data Visualisation</a> guide for tutorials about using <code>ggplot2</code>.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#60a0b0;font-style:italic">#We transformed back the x axis from &#34;age score&#34; into actual age by adding 2 and then multiplying by 10.</span>
plot <span style="color:#666">&lt;-</span> <span style="color:#06287e">ggplot</span>(Age_eff, <span style="color:#06287e">aes</span>(x <span style="color:#666">=</span> ((AgeR<span style="color:#40a070">+2</span>)<span style="color:#666">*</span><span style="color:#40a070">10</span>), y <span style="color:#666">=</span> prob)) <span style="color:#666">+</span>
    <span style="color:#06287e">geom_point</span>() <span style="color:#666">+</span> 
    <span style="color:#06287e">geom_line</span>() <span style="color:#666">+</span>
    <span style="color:#06287e">geom_errorbar</span>(<span style="color:#06287e">aes</span>(ymin <span style="color:#666">=</span> asymp.LCL, ymax <span style="color:#666">=</span> asymp.UCL), width <span style="color:#666">=</span> <span style="color:#40a070">1</span>) <span style="color:#666">+</span>
    <span style="color:#06287e">xlab</span>(<span style="color:#4070a0">&#34;Age&#34;</span>) <span style="color:#666">+</span>
    <span style="color:#06287e">ylab</span>(<span style="color:#4070a0">&#34;Probability of weeky cannabis use&#34;</span>)
    
plot
</code></pre></div><img src="https://statsnotebook.io/blog/analysis/img/apc_age_effect.png" alt="age-period-cohort age effect" title="age-period-cohort age effect"/></a>
<br/>

<h5 id="testing-the-joint-cohort-and-period-effect" class="anchor-link"><a href="#testing-the-joint-cohort-and-period-effect">Testing the joint cohort and period effect</a></h5>
<p>To test the joint cohort and period effect, we save the current model into a new variable <code>res_cohort_period</code> using the following codes.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">res_cohort_period <span style="color:#666">&lt;-</span> res
</code></pre></div><p>We then rerun the model without the cohort and period effect (i.e. removing the random effect of cohort and period). This can be done by removing the <em>cohort_cat</em> and <em>year</em> from random effect in <strong>StatsNotebook</strong>&rsquo;s menu or by changing the previous codes. The function <code>glm</code> will be used instead of <code>glmer</code></p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#06287e">library</span>(lme4)

res <span style="color:#666">&lt;-</span> <span style="color:#06287e">glm</span>(weekly_cannabis <span style="color:#666">~</span> AgeR <span style="color:#666">+</span> AgeR2 <span style="color:#666">+</span> Sex <span style="color:#666">+</span> remoteness <span style="color:#666">+</span> HighSchool,
  family <span style="color:#666">=</span> binomial,
  data <span style="color:#666">=</span> currentDataset)
<span style="color:#06287e">summary</span>(res)
<span style="color:#06287e">confint</span>(res, level <span style="color:#666">=</span> <span style="color:#40a070">0.95</span>, method <span style="color:#666">=</span> <span style="color:#4070a0">&#34;Wald&#34;</span>)
</code></pre></div><p>The above codes can be used to run the analysis without both cohort and period effect. To test the joint cohort and period effect, we can use a likelihood ratio test comparing both models using the <code>anova</code> function.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#06287e">anova</span>(res_cohort_period, res)
</code></pre></div><br/>
<p>This produces the output below. These results indicate that the model with cohort and period effect fits the data significantly better than the model without, indicating that at least one of the cohort or period effect is significantly different from zero.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">Data<span style="color:#666">:</span> currentDataset
Models<span style="color:#666">:</span>
res<span style="color:#666">:</span> weekly_cannabis <span style="color:#666">~</span> AgeR <span style="color:#666">+</span> AgeR2 <span style="color:#666">+</span> Sex <span style="color:#666">+</span> remoteness <span style="color:#666">+</span> HighSchool
res_cohort_period<span style="color:#666">:</span> weekly_cannabis <span style="color:#666">~</span> AgeR <span style="color:#666">+</span> AgeR2 <span style="color:#666">+</span> Sex <span style="color:#666">+</span> remoteness <span style="color:#666">+</span> HighSchool <span style="color:#666">+</span> 
res_cohort_period<span style="color:#666">:</span>     (<span style="color:#40a070">1</span> <span style="color:#666">|</span> cohort_cat) <span style="color:#666">+</span> (<span style="color:#40a070">1</span> <span style="color:#666">|</span> Year)
                  npar   AIC   BIC logLik deviance Chisq Df <span style="color:#06287e">Pr</span>(<span style="color:#666">&gt;</span>Chisq)    
res                  <span style="color:#40a070">7</span> <span style="color:#40a070">34069</span> <span style="color:#40a070">34136</span> <span style="color:#40a070">-17028</span>    <span style="color:#40a070">34055</span>                        
res_cohort_period    <span style="color:#40a070">9</span> <span style="color:#40a070">33929</span> <span style="color:#40a070">34014</span> <span style="color:#40a070">-16956</span>    <span style="color:#40a070">33911</span> <span style="color:#40a070">144.2</span>  <span style="color:#40a070">2</span>  <span style="color:#666">&lt;</span> <span style="color:#40a070">2.2e-16</span> <span style="color:#666">***</span>
<span style="color:#666">---</span>
Signif. codes<span style="color:#666">:</span>  <span style="color:#40a070">0</span> <span style="color:#4070a0">&#39;***&#39;</span> <span style="color:#40a070">0.001</span> <span style="color:#4070a0">&#39;**&#39;</span> <span style="color:#40a070">0.01</span> <span style="color:#4070a0">&#39;*&#39;</span> <span style="color:#40a070">0.05</span> <span style="color:#4070a0">&#39;.&#39;</span> <span style="color:#40a070">0.1</span> <span style="color:#4070a0">&#39; &#39;</span> <span style="color:#40a070">1</span>
</code></pre></div><br/>

<h5 id="testing-the-cohort-effect" class="anchor-link"><a href="#testing-the-cohort-effect">Testing the cohort effect</a></h5>
<p>We can also test the cohort or period effect individually. For example, we can test the cohort effect by running a model with only period effect, and compare this model with the model with both cohort and period effect. The following is generated by removing <em>cohort_cat</em> from the random effect in <strong>StatsNotebook</strong>&rsquo;s menu. We save the model output to the variable <em>res_period</em> instead of the default <em>res</em>.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">res <span style="color:#666">&lt;-</span> <span style="color:#06287e">glmer</span>(weekly_cannabis <span style="color:#666">~</span> AgeR <span style="color:#666">+</span> AgeR2 <span style="color:#666">+</span> Sex <span style="color:#666">+</span> remoteness <span style="color:#666">+</span> HighSchool <span style="color:#666">+</span> (<span style="color:#40a070">1</span> <span style="color:#666">|</span> Year),
  family <span style="color:#666">=</span> binomial,
  data <span style="color:#666">=</span> currentDataset)
<span style="color:#06287e">summary</span>(res)
<span style="color:#06287e">confint</span>(res, level <span style="color:#666">=</span> <span style="color:#40a070">0.95</span>, method <span style="color:#666">=</span> <span style="color:#4070a0">&#34;Wald&#34;</span>)

<span style="color:#60a0b0;font-style:italic">#We add the line of codes to save the model result to the variable res_period</span>
res_period <span style="color:#666">&lt;-</span> res
</code></pre></div><p>Similarly, we use the <code>anova</code> function to compare the model with both cohort and period effect and the model with only period effect.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#06287e">anova</span>(res_cohort_period, res_period)
</code></pre></div><p>This test produces the following results. The model with both cohort and period effect fits the data significantly better than the model with only period effect. This indicates that the cohort effect is significantly different from zero.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">Data<span style="color:#666">:</span> currentDataset
Models<span style="color:#666">:</span>
res_period<span style="color:#666">:</span> weekly_cannabis <span style="color:#666">~</span> AgeR <span style="color:#666">+</span> AgeR2 <span style="color:#666">+</span> Sex <span style="color:#666">+</span> remoteness <span style="color:#666">+</span> HighSchool <span style="color:#666">+</span> 
res_period<span style="color:#666">:</span>     (<span style="color:#40a070">1</span> <span style="color:#666">|</span> Year)
res_cohort_period<span style="color:#666">:</span> weekly_cannabis <span style="color:#666">~</span> AgeR <span style="color:#666">+</span> AgeR2 <span style="color:#666">+</span> Sex <span style="color:#666">+</span> remoteness <span style="color:#666">+</span> HighSchool <span style="color:#666">+</span> 
res_cohort_period<span style="color:#666">:</span>     (<span style="color:#40a070">1</span> <span style="color:#666">|</span> cohort_cat) <span style="color:#666">+</span> (<span style="color:#40a070">1</span> <span style="color:#666">|</span> Year)
                  npar   AIC   BIC logLik deviance  Chisq Df <span style="color:#06287e">Pr</span>(<span style="color:#666">&gt;</span>Chisq)    
res_period           <span style="color:#40a070">8</span> <span style="color:#40a070">34049</span> <span style="color:#40a070">34125</span> <span style="color:#40a070">-17016</span>    <span style="color:#40a070">34033</span>                         
res_cohort_period    <span style="color:#40a070">9</span> <span style="color:#40a070">33929</span> <span style="color:#40a070">34014</span> <span style="color:#40a070">-16956</span>    <span style="color:#40a070">33911</span> <span style="color:#40a070">121.81</span>  <span style="color:#40a070">1</span>  <span style="color:#666">&lt;</span> <span style="color:#40a070">2.2e-16</span> <span style="color:#666">***</span>
<span style="color:#666">---</span>
Signif. codes<span style="color:#666">:</span>  <span style="color:#40a070">0</span> <span style="color:#4070a0">&#39;***&#39;</span> <span style="color:#40a070">0.001</span> <span style="color:#4070a0">&#39;**&#39;</span> <span style="color:#40a070">0.01</span> <span style="color:#4070a0">&#39;*&#39;</span> <span style="color:#40a070">0.05</span> <span style="color:#4070a0">&#39;.&#39;</span> <span style="color:#40a070">0.1</span> <span style="color:#4070a0">&#39; &#39;</span> <span style="color:#40a070">1</span>
</code></pre></div><br/>

<h5 id="testing-the-period-effect" class="anchor-link"><a href="#testing-the-period-effect">Testing the period effect</a></h5>
<p>The period effect can be tested similiarly by comparing the model with both cohort and period effect against the model with only the cohort effect with the following codes.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#06287e">library</span>(lme4)

res <span style="color:#666">&lt;-</span> <span style="color:#06287e">glmer</span>(weekly_cannabis <span style="color:#666">~</span> AgeR <span style="color:#666">+</span> AgeR2 <span style="color:#666">+</span> Sex <span style="color:#666">+</span> remoteness <span style="color:#666">+</span> HighSchool <span style="color:#666">+</span> (<span style="color:#40a070">1</span> <span style="color:#666">|</span> cohort_cat),
  family <span style="color:#666">=</span> binomial,
  data <span style="color:#666">=</span> currentDataset)
<span style="color:#06287e">summary</span>(res)
<span style="color:#06287e">confint</span>(res, level <span style="color:#666">=</span> <span style="color:#40a070">0.95</span>, method <span style="color:#666">=</span> <span style="color:#4070a0">&#34;Wald&#34;</span>)

res_cohort <span style="color:#666">&lt;-</span> res

<span style="color:#06287e">anova</span>(res_cohort_period, res_cohort)
</code></pre></div><p>These codes produce the following results, which indicates that the period effect is also significantly different from zero.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">Data<span style="color:#666">:</span> currentDataset
Models<span style="color:#666">:</span>
res_cohort<span style="color:#666">:</span> weekly_cannabis <span style="color:#666">~</span> AgeR <span style="color:#666">+</span> AgeR2 <span style="color:#666">+</span> Sex <span style="color:#666">+</span> remoteness <span style="color:#666">+</span> HighSchool <span style="color:#666">+</span> 
res_cohort<span style="color:#666">:</span>     (<span style="color:#40a070">1</span> <span style="color:#666">|</span> cohort_cat)
res_cohort_period<span style="color:#666">:</span> weekly_cannabis <span style="color:#666">~</span> AgeR <span style="color:#666">+</span> AgeR2 <span style="color:#666">+</span> Sex <span style="color:#666">+</span> remoteness <span style="color:#666">+</span> HighSchool <span style="color:#666">+</span> 
res_cohort_period<span style="color:#666">:</span>     (<span style="color:#40a070">1</span> <span style="color:#666">|</span> cohort_cat) <span style="color:#666">+</span> (<span style="color:#40a070">1</span> <span style="color:#666">|</span>cyw195510  Year)
                  npar   AIC   BIC logLik deviance  Chisq Df <span style="color:#06287e">Pr</span>(<span style="color:#666">&gt;</span>Chisq)    
res_cohort           <span style="color:#40a070">8</span> <span style="color:#40a070">33950</span> <span style="color:#40a070">34026</span> <span style="color:#40a070">-16967</span>    <span style="color:#40a070">33934</span>                         
res_cohort_period    <span style="color:#40a070">9</span> <span style="color:#40a070">33929</span> <span style="color:#40a070">34014</span> <span style="color:#40a070">-16956</span>    <span style="color:#40a070">33911</span> <span style="color:#40a070">23.093</span>  <span style="color:#40a070">1</span>  <span style="color:#40a070">1.543e-06</span> <span style="color:#666">***</span>
<span style="color:#666">---</span>
Signif. codes<span style="color:#666">:</span>  <span style="color:#40a070">0</span> <span style="color:#4070a0">&#39;***&#39;</span> <span style="color:#40a070">0.001</span> <span style="color:#4070a0">&#39;**&#39;</span> <span style="color:#40a070">0.01</span> <span style="color:#4070a0">&#39;*&#39;</span> <span style="color:#40a070">0.05</span> <span style="color:#4070a0">&#39;.&#39;</span> <span style="color:#40a070">0.1</span> <span style="color:#4070a0">&#39; &#39;</span> <span style="color:#40a070">1</span>
</code></pre></div><br/>

<h5 id="visualising-the-cohort-effect" class="anchor-link"><a href="#visualising-the-cohort-effect">Visualising the cohort effect</a></h5>
<p>Now that we know there are cohort and period effect on weekly cannabis use. We can visualise both effects. Suppose that we have stored the results from the model with both cohort and period effect into the variable <code>res_cohort_period</code>. We can use the <code>ranef</code> function to extract the random effect components, the cohort and period effect, from this model.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#60a0b0;font-style:italic">#Extract the random effect</span>
u0 <span style="color:#666">&lt;-</span> <span style="color:#06287e">ranef</span>(res_cohort_period, condVar <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">TRUE</span>)
<span style="color:#06287e">names</span>(u0<span style="color:#666">$</span>Year) <span style="color:#666">&lt;-</span> <span style="color:#4070a0">&#34;est&#34;</span>
<span style="color:#06287e">names</span>(u0<span style="color:#666">$</span>cohort_cat) <span style="color:#666">&lt;-</span> <span style="color:#4070a0">&#34;est&#34;</span>

<span style="color:#60a0b0;font-style:italic">#Extract the standard error</span>
period_eff <span style="color:#666">&lt;-</span> <span style="color:#06287e">data.frame</span>(est <span style="color:#666">=</span> u0<span style="color:#666">$</span>Year, se <span style="color:#666">=</span> <span style="color:#06287e">sqrt</span>(<span style="color:#06287e">attr</span>(u0[[1]], <span style="color:#4070a0">&#34;postVar&#34;</span>)[1, ,]),
  period <span style="color:#666">=</span> <span style="color:#06287e">c</span>(<span style="color:#40a070">2001</span>, <span style="color:#40a070">2004</span>, <span style="color:#40a070">2007</span>, <span style="color:#40a070">2010</span>, <span style="color:#40a070">2013</span>, <span style="color:#40a070">2016</span>, <span style="color:#40a070">2019</span>))
cohort_eff <span style="color:#666">&lt;-</span> <span style="color:#06287e">data.frame</span>(est <span style="color:#666">=</span> u0<span style="color:#666">$</span>cohort_cat, se <span style="color:#666">=</span> <span style="color:#06287e">sqrt</span>(<span style="color:#06287e">attr</span>(u0[[2]], <span style="color:#4070a0">&#34;postVar&#34;</span>)[1, ,]),
  cohort <span style="color:#666">=</span> <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;1941/50&#34;</span>,<span style="color:#4070a0">&#34;1951/60&#34;</span>,<span style="color:#4070a0">&#34;1961/70&#34;</span>,<span style="color:#4070a0">&#34;1971/80&#34;</span>,<span style="color:#4070a0">&#34;1981/90&#34;</span>,<span style="color:#4070a0">&#34;1991/2000&#34;</span>))

period_eff<span style="color:#666">$</span>upper <span style="color:#666">&lt;-</span> period_eff<span style="color:#666">$</span>est <span style="color:#666">+</span> <span style="color:#40a070">1.96</span><span style="color:#666">*</span>period_eff<span style="color:#666">$</span>se
period_eff<span style="color:#666">$</span>lower <span style="color:#666">&lt;-</span> period_eff<span style="color:#666">$</span>est <span style="color:#666">-</span> <span style="color:#40a070">1.96</span><span style="color:#666">*</span>period_eff<span style="color:#666">$</span>se
cohort_eff<span style="color:#666">$</span>upper <span style="color:#666">&lt;-</span> cohort_eff<span style="color:#666">$</span>est <span style="color:#666">+</span> <span style="color:#40a070">1.96</span><span style="color:#666">*</span>cohort_eff<span style="color:#666">$</span>se
cohort_eff<span style="color:#666">$</span>lower <span style="color:#666">&lt;-</span> cohort_eff<span style="color:#666">$</span>est <span style="color:#666">-</span> <span style="color:#40a070">1.96</span><span style="color:#666">*</span>cohort_eff<span style="color:#666">$</span>se

<span style="color:#60a0b0;font-style:italic">#Visualise the period and cohort effect using ggplot2</span>
plot <span style="color:#666">&lt;-</span> <span style="color:#06287e">ggplot</span>(period_eff, <span style="color:#06287e">aes</span>(x <span style="color:#666">=</span> period, y <span style="color:#666">=</span> est)) <span style="color:#666">+</span>
  <span style="color:#06287e">geom_point</span>() <span style="color:#666">+</span> 
  <span style="color:#06287e">geom_errorbar</span>(<span style="color:#06287e">aes</span>(ymin <span style="color:#666">=</span> lower, ymax <span style="color:#666">=</span> upper), width <span style="color:#666">=</span> <span style="color:#40a070">.2</span>) <span style="color:#666">+</span> 
  <span style="color:#06287e">xlab</span>(<span style="color:#4070a0">&#34;Year&#34;</span>) <span style="color:#666">+</span> 
  <span style="color:#06287e">ylab</span>(<span style="color:#4070a0">&#34;Conditional log odds of the period effect&#34;</span>)

plot

plot <span style="color:#666">&lt;-</span> <span style="color:#06287e">ggplot</span>(cohort_eff, <span style="color:#06287e">aes</span>(x <span style="color:#666">=</span> cohort, y <span style="color:#666">=</span> est)) <span style="color:#666">+</span>
  <span style="color:#06287e">geom_point</span>() <span style="color:#666">+</span> 
  <span style="color:#06287e">geom_errorbar</span>(<span style="color:#06287e">aes</span>(ymin <span style="color:#666">=</span> lower, ymax <span style="color:#666">=</span> upper), width <span style="color:#666">=</span> <span style="color:#40a070">.2</span>) <span style="color:#666">+</span> 
  <span style="color:#06287e">xlab</span>(<span style="color:#4070a0">&#34;Year&#34;</span>) <span style="color:#666">+</span> 
  <span style="color:#06287e">ylab</span>(<span style="color:#4070a0">&#34;Conditional log odds of the cohort effect&#34;</span>)

plot

</code></pre></div><img src="https://statsnotebook.io/blog/analysis/img/apc_period_effect.png" alt="age-period-cohort period effect" title="age-period-cohort period effect"/></a>
<img src="https://statsnotebook.io/blog/analysis/img/apc_cohort_effect.png" alt="age-period-cohort cohort effect" title="age-period-cohort cohort effect"/></a>

	<br/>
	<p><strong>Follow <a href="https://www.facebook.com/StatsNotebook/">our Facebook page</a> or <a href="https://twitter.com/GaryCKChan">our developer&rsquo;s Twitter</a> for more tutorials and future updates.</strong></p>
</div>





                
                <div class="container">
    <hr>
</div>
<div class="container has-text-centered top-pad">
    <a href="#top">
        <i class="fa fa-arrow-up"></i>
    </a>
</div>

<div class="container">
    <hr>
</div>

                <div class="section" id="footer">
    <div class="container has-text-centered">
    
        <span class="footer-text">
            <a href="https://github.com/victoriadrake/hugo-theme-introduction/"><strong>Introduction</strong></a> theme for <a href="http://gohugo.io/">Hugo</a>. Made with <a href="https://victoria.dev"><i class="fa fa-heart"></i> and <i class="fa fa-coffee"></i></a> by open source contributors.
        </span>
    
    </div>
</div>

                
            </div>
        </section>
        
        


<script src="https://statsnotebook.io/js/bundle.2ee571453a8980175e10bda96bda797cc9c4e2e745e488df68d50cef5deb57ff.js" integrity="sha256-LuVxRTqJgBdeEL2pa9p5fMnE4udF5IjfaNUM713rV/8="></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-180705456-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>





        
        
        
        
    </body>
</html>
